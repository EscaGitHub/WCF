<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\!Work\!GIT\SWR-Conf\Source\SWR-ConfiguratorAPI\AvalonDock.Version2.0\Xceed.Wpf.AvalonDock\Controls\DockingManagerDropTarget.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
/************************************************************************

   AvalonDock

   Copyright (C) 2007-2013 Xceed Software Inc.

   This program is provided to you under the terms of the New BSD
   License (BSD) as published at http://avalondock.codeplex.com/license 

   For more features, controls, and fast professional support,
   pick up AvalonDock in Extended WPF Toolkit Plus at http://xceed.com/wpf_toolkit

   Stay informed: follow @datagrid on Twitter or Like facebook.com/datagrids

  **********************************************************************/

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Media;
using Xceed.Wpf.AvalonDock.Layout;

namespace Xceed.Wpf.AvalonDock.Controls
{
    internal class DockingManagerDropTarget : DropTarget&lt;DockingManager&gt;
    {
        internal DockingManagerDropTarget(DockingManager manager, Rect detectionRect, DropTargetType type)
            : base(manager, detectionRect, type)
        {
            _manager = manager;
        }

        DockingManager _manager;

        protected override void Drop(LayoutAnchorableFloatingWindow floatingWindow)
        {
            switch (Type)
            {
                case DropTargetType.DockingManagerDockLeft:
                    #region DropTargetType.DockingManagerDockLeft
                    {
                        if (_manager.Layout.RootPanel.Orientation != System.Windows.Controls.Orientation.Horizontal &amp;&amp;
                            _manager.Layout.RootPanel.Children.Count == 1)
                            _manager.Layout.RootPanel.Orientation = System.Windows.Controls.Orientation.Horizontal;

                        if (_manager.Layout.RootPanel.Orientation == System.Windows.Controls.Orientation.Horizontal)
                        {
                            var layoutAnchorablePaneGroup = floatingWindow.RootPanel as LayoutAnchorablePaneGroup;
                            if (layoutAnchorablePaneGroup != null &amp;&amp;
                                layoutAnchorablePaneGroup.Orientation == System.Windows.Controls.Orientation.Horizontal)
                            {
                                var childrenToTransfer = layoutAnchorablePaneGroup.Children.ToArray();
                                for (int i = 0; i &lt; childrenToTransfer.Length; i++)
                                    _manager.Layout.RootPanel.Children.Insert(i, childrenToTransfer[i]);
                            }
                            else
                                _manager.Layout.RootPanel.Children.Insert(0, floatingWindow.RootPanel);
                        }
                        else
                        {
                            var newOrientedPanel = new LayoutPanel()
                            {
                                Orientation = System.Windows.Controls.Orientation.Horizontal
                            };

                            newOrientedPanel.Children.Add(floatingWindow.RootPanel);
                            newOrientedPanel.Children.Add(_manager.Layout.RootPanel);

                            _manager.Layout.RootPanel = newOrientedPanel;
                        }
                    }
                    break;
                    #endregion
                case DropTargetType.DockingManagerDockRight:
                    #region DropTargetType.DockingManagerDockRight
                    {
                        if (_manager.Layout.RootPanel.Orientation != System.Windows.Controls.Orientation.Horizontal &amp;&amp;
                            _manager.Layout.RootPanel.Children.Count == 1)
                            _manager.Layout.RootPanel.Orientation = System.Windows.Controls.Orientation.Horizontal;

                        if (_manager.Layout.RootPanel.Orientation == System.Windows.Controls.Orientation.Horizontal)
                        {
                            var layoutAnchorablePaneGroup = floatingWindow.RootPanel as LayoutAnchorablePaneGroup;
                            if (layoutAnchorablePaneGroup != null &amp;&amp;
                                layoutAnchorablePaneGroup.Orientation == System.Windows.Controls.Orientation.Horizontal)
                            {
                                var childrenToTransfer = layoutAnchorablePaneGroup.Children.ToArray();
                                for (int i = 0; i &lt; childrenToTransfer.Length; i++)
                                    _manager.Layout.RootPanel.Children.Add(childrenToTransfer[i]);
                            }
                            else
                                _manager.Layout.RootPanel.Children.Add(floatingWindow.RootPanel);
                        }
                        else
                        {
                            var newOrientedPanel = new LayoutPanel()
                            {
                                Orientation = System.Windows.Controls.Orientation.Horizontal
                            };

                            newOrientedPanel.Children.Add(_manager.Layout.RootPanel);
                            newOrientedPanel.Children.Add(floatingWindow.RootPanel);

                            _manager.Layout.RootPanel = newOrientedPanel;
                        }
                    }
                    break;
                    #endregion
                case DropTargetType.DockingManagerDockTop:
                    #region DropTargetType.DockingManagerDockTop
                    {
                        if (_manager.Layout.RootPanel.Orientation != System.Windows.Controls.Orientation.Vertical &amp;&amp;
                            _manager.Layout.RootPanel.Children.Count == 1)
                            _manager.Layout.RootPanel.Orientation = System.Windows.Controls.Orientation.Vertical;

                        if (_manager.Layout.RootPanel.Orientation == System.Windows.Controls.Orientation.Vertical)
                        {
                            var layoutAnchorablePaneGroup = floatingWindow.RootPanel as LayoutAnchorablePaneGroup;
                            if (layoutAnchorablePaneGroup != null &amp;&amp;
                                layoutAnchorablePaneGroup.Orientation == System.Windows.Controls.Orientation.Vertical)
                            {
                                var childrenToTransfer = layoutAnchorablePaneGroup.Children.ToArray();
                                for (int i = 0; i &lt; childrenToTransfer.Length; i++)
                                    _manager.Layout.RootPanel.Children.Insert(i, childrenToTransfer[i]);
                            }
                            else
                                _manager.Layout.RootPanel.Children.Insert(0, floatingWindow.RootPanel);
                        }
                        else
                        {
                            var newOrientedPanel = new LayoutPanel()
                            {
                                Orientation = System.Windows.Controls.Orientation.Vertical
                            };

                            newOrientedPanel.Children.Add(floatingWindow.RootPanel);
                            newOrientedPanel.Children.Add(_manager.Layout.RootPanel);

                            _manager.Layout.RootPanel = newOrientedPanel;
                        }
                    }
                    break;
                    #endregion
                case DropTargetType.DockingManagerDockBottom:
                    #region DropTargetType.DockingManagerDockBottom
                    {
                        if (_manager.Layout.RootPanel.Orientation != System.Windows.Controls.Orientation.Vertical &amp;&amp;
                            _manager.Layout.RootPanel.Children.Count == 1)
                            _manager.Layout.RootPanel.Orientation = System.Windows.Controls.Orientation.Vertical;

                        if (_manager.Layout.RootPanel.Orientation == System.Windows.Controls.Orientation.Vertical)
                        {
                            var layoutAnchorablePaneGroup = floatingWindow.RootPanel as LayoutAnchorablePaneGroup;
                            if (layoutAnchorablePaneGroup != null &amp;&amp;
                                layoutAnchorablePaneGroup.Orientation == System.Windows.Controls.Orientation.Vertical)
                            {
                                var childrenToTransfer = layoutAnchorablePaneGroup.Children.ToArray();
                                for (int i = 0; i &lt; childrenToTransfer.Length; i++)
                                    _manager.Layout.RootPanel.Children.Add(childrenToTransfer[i]);

                            }
                            else
                                _manager.Layout.RootPanel.Children.Add(floatingWindow.RootPanel);
                        }
                        else
                        {
                            var newOrientedPanel = new LayoutPanel()
                            {
                                Orientation = System.Windows.Controls.Orientation.Vertical
                            };

                            newOrientedPanel.Children.Add(_manager.Layout.RootPanel);
                            newOrientedPanel.Children.Add(floatingWindow.RootPanel);

                            _manager.Layout.RootPanel = newOrientedPanel;
                        }
                    }
                    break;
                    #endregion
            }


            base.Drop(floatingWindow);
        }

        public override System.Windows.Media.Geometry GetPreviewPath(OverlayWindow overlayWindow, LayoutFloatingWindow floatingWindowModel)
        {
            var anchorableFloatingWindowModel = floatingWindowModel as LayoutAnchorableFloatingWindow;
            var layoutAnchorablePane = anchorableFloatingWindowModel.RootPanel as ILayoutPositionableElement;
            var layoutAnchorablePaneWithActualSize = anchorableFloatingWindowModel.RootPanel as ILayoutPositionableElementWithActualSize;

            var targetScreenRect = TargetElement.GetScreenArea();

            switch (Type)
            {
                case DropTargetType.DockingManagerDockLeft:
                    {
                        var desideredWidth = layoutAnchorablePane.DockWidth.IsAbsolute ? layoutAnchorablePane.DockWidth.Value : layoutAnchorablePaneWithActualSize.ActualWidth;
                        var previewBoxRect = new Rect(
                            targetScreenRect.Left - overlayWindow.Left,
                            targetScreenRect.Top - overlayWindow.Top,
                            Math.Min(desideredWidth, targetScreenRect.Width / 2.0),
                            targetScreenRect.Height);

                        return new RectangleGeometry(previewBoxRect);
                    }
                case DropTargetType.DockingManagerDockTop:
                    {
                        var desideredHeight = layoutAnchorablePane.DockHeight.IsAbsolute ? layoutAnchorablePane.DockHeight.Value : layoutAnchorablePaneWithActualSize.ActualHeight;
                        var previewBoxRect = new Rect(
                            targetScreenRect.Left - overlayWindow.Left,
                            targetScreenRect.Top - overlayWindow.Top,
                            targetScreenRect.Width,
                            Math.Min(desideredHeight, targetScreenRect.Height / 2.0));

                        return new RectangleGeometry(previewBoxRect);
                    }
                case DropTargetType.DockingManagerDockRight:
                    {
                        var desideredWidth = layoutAnchorablePane.DockWidth.IsAbsolute ? layoutAnchorablePane.DockWidth.Value : layoutAnchorablePaneWithActualSize.ActualWidth;
                        var previewBoxRect = new Rect(
                            targetScreenRect.Right - overlayWindow.Left - Math.Min(desideredWidth, targetScreenRect.Width / 2.0),
                            targetScreenRect.Top - overlayWindow.Top,
                            Math.Min(desideredWidth, targetScreenRect.Width / 2.0),
                            targetScreenRect.Height);

                        return new RectangleGeometry(previewBoxRect);
                    }
                case DropTargetType.DockingManagerDockBottom:
                    {
                        var desideredHeight = layoutAnchorablePane.DockHeight.IsAbsolute ? layoutAnchorablePane.DockHeight.Value : layoutAnchorablePaneWithActualSize.ActualHeight;
                        var previewBoxRect = new Rect(
                            targetScreenRect.Left - overlayWindow.Left,
                            targetScreenRect.Bottom - overlayWindow.Top - Math.Min(desideredHeight, targetScreenRect.Height / 2.0),
                            targetScreenRect.Width,
                            Math.Min(desideredHeight, targetScreenRect.Height / 2.0));

                        return new RectangleGeometry(previewBoxRect);
                    }
            }


            throw new InvalidOperationException();
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[30,15,30,49,0],[31,9,31,10,0],[32,13,32,32,0],[33,9,33,10,0],[38,9,38,10,0],[39,13,39,26,0],[43,21,43,22,0],[44,25,45,75,0],[46,29,46,116,0],[48,25,48,117,0],[49,25,49,26,0],[50,29,50,115,0],[51,29,52,121,0],[53,29,53,30,0],[54,33,54,103,0],[55,38,55,47,0],[55,49,55,78,0],[55,80,55,83,0],[56,37,56,105,0],[57,29,57,30,0],[59,33,59,104,0],[60,25,60,26,0],[62,25,62,26,0],[63,29,66,31,0],[68,29,68,85,0],[69,29,69,86,0],[71,29,71,74,0],[72,25,72,26,0],[73,21,73,22,0],[74,21,74,27,0],[78,21,78,22,0],[79,25,80,75,0],[81,29,81,116,0],[83,25,83,117,0],[84,25,84,26,0],[85,29,85,115,0],[86,29,87,121,0],[88,29,88,30,0],[89,33,89,103,0],[90,38,90,47,0],[90,49,90,78,0],[90,80,90,83,0],[91,37,91,99,0],[92,29,92,30,0],[94,33,94,98,0],[95,25,95,26,0],[97,25,97,26,0],[98,29,101,31,0],[103,29,103,86,0],[104,29,104,85,0],[106,29,106,74,0],[107,25,107,26,0],[108,21,108,22,0],[109,21,109,27,0],[113,21,113,22,0],[114,25,115,75,0],[116,29,116,114,0],[118,25,118,115,0],[119,25,119,26,0],[120,29,120,115,0],[121,29,122,119,0],[123,29,123,30,0],[124,33,124,103,0],[125,38,125,47,0],[125,49,125,78,0],[125,80,125,83,0],[126,37,126,105,0],[127,29,127,30,0],[129,33,129,104,0],[130,25,130,26,0],[132,25,132,26,0],[133,29,136,31,0],[138,29,138,85,0],[139,29,139,86,0],[141,29,141,74,0],[142,25,142,26,0],[143,21,143,22,0],[144,21,144,27,0],[148,21,148,22,0],[149,25,150,75,0],[151,29,151,114,0],[153,25,153,115,0],[154,25,154,26,0],[155,29,155,115,0],[156,29,157,119,0],[158,29,158,30,0],[159,33,159,103,0],[160,38,160,47,0],[160,49,160,78,0],[160,80,160,83,0],[161,37,161,99,0],[163,29,163,30,0],[165,33,165,98,0],[166,25,166,26,0],[168,25,168,26,0],[169,29,172,31,0],[174,29,174,86,0],[175,29,175,85,0],[177,29,177,74,0],[178,25,178,26,0],[179,21,179,22,0],[180,21,180,27,0],[185,13,185,39,0],[186,9,186,10,0],[189,9,189,10,0],[190,13,190,103,0],[191,13,191,110,0],[192,13,192,138,0],[194,13,194,66,0],[196,13,196,26,0],[199,21,199,22,0],[200,25,200,176,0],[201,25,205,54,0],[207,25,207,70,0],[210,21,210,22,0],[211,25,211,180,0],[212,25,216,87,0],[218,25,218,70,0],[221,21,221,22,0],[222,25,222,176,0],[223,25,227,54,0],[229,25,229,70,0],[232,21,232,22,0],[233,25,233,180,0],[234,25,238,87,0],[240,25,240,70,0],[245,13,245,51,0],[246,9,246,10,0]]);
    </script>
  </body>
</html>