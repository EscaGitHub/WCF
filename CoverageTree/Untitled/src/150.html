<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\!Work\!GIT\SWR-Conf\Source\SWR-ConfiguratorAPI\AvalonDock.Version2.0\Xceed.Wpf.AvalonDock\DockingManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
/************************************************************************

   AvalonDock

   Copyright (C) 2007-2013 Xceed Software Inc.

   This program is provided to you under the terms of the New BSD
   License (BSD) as published at http://avalondock.codeplex.com/license 

   For more features, controls, and fast professional support,
   pick up AvalonDock in Extended WPF Toolkit Plus at http://xceed.com/wpf_toolkit

   Stay informed: follow @datagrid on Twitter or Like facebook.com/datagrids

  **********************************************************************/

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Controls;
using System.Windows;
using System.Windows.Markup;
using System.ComponentModel;
using System.Windows.Interop;
using System.Diagnostics;

using Xceed.Wpf.AvalonDock.Layout;
using Xceed.Wpf.AvalonDock.Controls;
using System.Windows.Input;
using System.Collections;
using System.Collections.Specialized;
using System.Windows.Data;
using System.Windows.Threading;
using Xceed.Wpf.AvalonDock.Commands;
using Xceed.Wpf.AvalonDock.Themes;

namespace Xceed.Wpf.AvalonDock
{
    [ContentProperty(&quot;Layout&quot;)]
    [TemplatePart(Name=&quot;PART_AutoHideArea&quot;)]
    public class DockingManager : Control, IOverlayWindowHost//, ILogicalChildrenContainer
    {
        static DockingManager()
        {
            DefaultStyleKeyProperty.OverrideMetadata(typeof(DockingManager), new FrameworkPropertyMetadata(typeof(DockingManager)));
            FocusableProperty.OverrideMetadata(typeof(DockingManager), new FrameworkPropertyMetadata(false));
			FontSizeProperty.OverrideMetadata(typeof(DockingManager), new FrameworkPropertyMetadata(FontSizeVslueChanged));
            HwndSource.DefaultAcquireHwndFocusInMenuMode = false;
        }

	    private static void FontSizeVslueChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
	    {
		    var manager = d as DockingManager;
			if (manager == null)
				return;

		    manager.OnFontSizeChanged();
	    }

	    private void OnFontSizeChanged()
	    {
		    foreach (var layoutFloatingWindowControl in FloatingWindows)
		    {
			    layoutFloatingWindowControl.FontSize = FontSize;
		    }
	    }


	    public DockingManager()
        {
            Layout = new LayoutRoot() { RootPanel = new LayoutPanel(new LayoutDocumentPaneGroup(new LayoutDocumentPane())) };


            this.Loaded += new RoutedEventHandler(DockingManager_Loaded);
            this.Unloaded += new RoutedEventHandler(DockingManager_Unloaded);
        }

        #region Layout

        /// &lt;summary&gt;
        /// Layout Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutProperty =
            DependencyProperty.Register(&quot;Layout&quot;, typeof(LayoutRoot), typeof(DockingManager),
                new FrameworkPropertyMetadata(null,
                    new PropertyChangedCallback(OnLayoutChanged),
                    new CoerceValueCallback(CoerceLayoutValue)));

        /// &lt;summary&gt;
        /// Gets or sets the Layout property.  This dependency property 
        /// indicates layout tree.
        /// &lt;/summary&gt;
        public LayoutRoot Layout
        {
            get { return (LayoutRoot)GetValue(LayoutProperty); }
            set { SetValue(LayoutProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the Layout property.
        /// &lt;/summary&gt;
        private static void OnLayoutChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLayoutChanged(e.OldValue as LayoutRoot, e.NewValue as LayoutRoot);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the &lt;see cref=&quot;DockingManager.Layout&quot;/&gt; property.
        /// &lt;/summary&gt;
        protected virtual void OnLayoutChanged(LayoutRoot oldLayout, LayoutRoot newLayout)
        {
            if (oldLayout != null)
            {
                oldLayout.PropertyChanged -= new PropertyChangedEventHandler(OnLayoutRootPropertyChanged);
                oldLayout.Updated -= new EventHandler(OnLayoutRootUpdated);
            }

            foreach (var fwc in _fwList.ToArray())
            {
                fwc.KeepContentVisibleOnClose = true;
                fwc.InternalClose();
            }

            _fwList.Clear();

            DetachDocumentsSource(oldLayout, DocumentsSource);
            DetachAnchorablesSource(oldLayout, AnchorablesSource);

            if (oldLayout != null &amp;&amp;
                oldLayout.Manager == this)
                oldLayout.Manager = null;

            ClearLogicalChildrenList();
            DetachLayoutItems();

            Layout.Manager = this;

            AttachLayoutItems();
            AttachDocumentsSource(newLayout, DocumentsSource);
            AttachAnchorablesSource(newLayout, AnchorablesSource);

            if (IsLoaded)
            {
                LayoutRootPanel = CreateUIElementForModel(Layout.RootPanel) as LayoutPanelControl;
                LeftSidePanel = CreateUIElementForModel(Layout.LeftSide) as LayoutAnchorSideControl;
                TopSidePanel = CreateUIElementForModel(Layout.TopSide) as LayoutAnchorSideControl;
                RightSidePanel = CreateUIElementForModel(Layout.RightSide) as LayoutAnchorSideControl;
                BottomSidePanel = CreateUIElementForModel(Layout.BottomSide) as LayoutAnchorSideControl;

                foreach (var fw in Layout.FloatingWindows.ToArray())
                {
                    if (fw.IsValid)
                       _fwList.Add(CreateUIElementForModel(fw) as LayoutFloatingWindowControl);
                }

                foreach (var fw in _fwList)
                {
                    //fw.Owner = Window.GetWindow(this);
                    //fw.SetParentToMainWindowOf(this);
                }
            }


            if (newLayout != null)
            {
                newLayout.PropertyChanged += new PropertyChangedEventHandler(OnLayoutRootPropertyChanged);
                newLayout.Updated += new EventHandler(OnLayoutRootUpdated);
            }

            if (LayoutChanged != null)
                LayoutChanged(this, EventArgs.Empty);

            //if (Layout != null)
            //    Layout.CollectGarbage();

            CommandManager.InvalidateRequerySuggested();
        }

        DispatcherOperation _setFocusAsyncOperation = null;

        void OnLayoutRootPropertyChanged(object sender, PropertyChangedEventArgs e)
        {
            if (e.PropertyName == &quot;RootPanel&quot;)
            {
                if (IsInitialized)
                {
                    var layoutRootPanel = CreateUIElementForModel(Layout.RootPanel) as LayoutPanelControl;
                    LayoutRootPanel = layoutRootPanel;
                }
            }
            else if (e.PropertyName == &quot;ActiveContent&quot;)
            {
                if (Layout.ActiveContent != null)
                {
                    //Debug.WriteLine(new StackTrace().ToString());

                    //set focus on active element only after a layout pass is completed
                    //it&#39;s possible that it is not yet visible in the visual tree
                    if (_setFocusAsyncOperation == null)
                    {
                        _setFocusAsyncOperation = Dispatcher.BeginInvoke(new Action(() =&gt;
                            {
                                if (Layout.ActiveContent != null)
                                    FocusElementManager.SetFocusOnLastElement(Layout.ActiveContent);
                                _setFocusAsyncOperation = null;
                            }), DispatcherPriority.Background);
                    }
                }

                if (!_insideInternalSetActiveContent)
                    ActiveContent = Layout.ActiveContent != null ?
                        Layout.ActiveContent.Content : null;
            }
        }

        void OnLayoutRootUpdated(object sender, EventArgs e)
        {
            CommandManager.InvalidateRequerySuggested();
        }


        /// &lt;summary&gt;
        /// Event fired when &lt;see cref=&quot;DockingManager.Layout&quot;/&gt; property changes
        /// &lt;/summary&gt;
        public event EventHandler LayoutChanged;

        /// &lt;summary&gt;
        /// Coerces the &lt;see cref=&quot;DockingManager.Layout&quot;/&gt; value.
        /// &lt;/summary&gt;
        private static object CoerceLayoutValue(DependencyObject d, object value)
        {
            if (value == null)
                return new LayoutRoot() { RootPanel = new LayoutPanel(new LayoutDocumentPaneGroup(new LayoutDocumentPane())) };

            ((DockingManager)d).OnLayoutChanging(value as LayoutRoot);

            return value;
        }

        /// &lt;summary&gt;
        /// Event fired when &lt;see cref=&quot;DockingManager.Layout&quot;/&gt; property is about to be changed
        /// &lt;/summary&gt;
        public event EventHandler LayoutChanging;

        void OnLayoutChanging(LayoutRoot newLayout)
        {
            if (LayoutChanging != null)
                LayoutChanging(this, EventArgs.Empty);
        }


        #region LayoutUpdateStrategy

        /// &lt;summary&gt;
        /// LayoutUpdateStrategy Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutUpdateStrategyProperty =
            DependencyProperty.Register(&quot;LayoutUpdateStrategy&quot;, typeof(ILayoutUpdateStrategy), typeof(DockingManager),
                new FrameworkPropertyMetadata((ILayoutUpdateStrategy)null));

        /// &lt;summary&gt;
        /// Gets or sets the LayoutUpdateStrategy property.  This dependency property 
        /// indicates the strategy class to call when AvalonDock needs to positionate a LayoutAnchorable inside an existing layout.
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;Sometimes it&#39;s impossible to automatically insert an anchorable in the layout without specifing the target parent pane.
        /// Set this property to an object that will be asked to insert the anchorable to the desidered position.&lt;/remarks&gt;
        public ILayoutUpdateStrategy LayoutUpdateStrategy
        {
            get { return (ILayoutUpdateStrategy)GetValue(LayoutUpdateStrategyProperty); }
            set { SetValue(LayoutUpdateStrategyProperty, value); }
        }

        #endregion



        #endregion

        public override void OnApplyTemplate()
        {
            base.OnApplyTemplate();

            SetupAutoHideWindow();
        }

        protected override void OnInitialized(EventArgs e)
        {
            base.OnInitialized(e);

            if (Layout.Manager == this)
            {
                LayoutRootPanel = CreateUIElementForModel(Layout.RootPanel) as LayoutPanelControl;
                LeftSidePanel = CreateUIElementForModel(Layout.LeftSide) as LayoutAnchorSideControl;
                TopSidePanel = CreateUIElementForModel(Layout.TopSide) as LayoutAnchorSideControl;
                RightSidePanel = CreateUIElementForModel(Layout.RightSide) as LayoutAnchorSideControl;
                BottomSidePanel = CreateUIElementForModel(Layout.BottomSide) as LayoutAnchorSideControl;
            }


        }

        void DockingManager_Loaded(object sender, RoutedEventArgs e)
        {
            if (!DesignerProperties.GetIsInDesignMode(this))
            {
                //load windows not already loaded!
                foreach (var fw in Layout.FloatingWindows.Where(fw =&gt; !_fwList.Any(fwc =&gt; fwc.Model == fw)))
                    _fwList.Add(CreateUIElementForModel(fw) as LayoutFloatingWindowControl);

                //create the overlaywindow if it&#39;s possible
                if (IsVisible)
                    CreateOverlayWindow();
                FocusElementManager.SetupFocusManagement(this);
            }
        }

        void DockingManager_Unloaded(object sender, RoutedEventArgs e)
        {

            if (!DesignerProperties.GetIsInDesignMode(this))
            {
                _autoHideWindowManager.HideAutoWindow();

                foreach (var fw in _fwList.ToArray())
                {
                    //fw.Owner = null;
                    fw.SetParentWindowToNull();
                    fw.KeepContentVisibleOnClose = true;
                    fw.Close();
                }

                DestroyOverlayWindow();
                FocusElementManager.FinalizeFocusManagement(this);
            }
        }

        internal UIElement CreateUIElementForModel(ILayoutElement model)
        {
            if (model is LayoutPanel)
                return new LayoutPanelControl(model as LayoutPanel);
            if (model is LayoutAnchorablePaneGroup)
                return new LayoutAnchorablePaneGroupControl(model as LayoutAnchorablePaneGroup);
            if (model is LayoutDocumentPaneGroup)
                return new LayoutDocumentPaneGroupControl(model as LayoutDocumentPaneGroup);

            if (model is LayoutAnchorSide)
            {
                var templateModelView = new LayoutAnchorSideControl(model as LayoutAnchorSide);
                templateModelView.SetBinding(LayoutAnchorSideControl.TemplateProperty, new Binding(&quot;AnchorSideTemplate&quot;) { Source = this });
                return templateModelView;
            }
            if (model is LayoutAnchorGroup)
            {
                var templateModelView = new LayoutAnchorGroupControl(model as LayoutAnchorGroup);
                templateModelView.SetBinding(LayoutAnchorGroupControl.TemplateProperty, new Binding(&quot;AnchorGroupTemplate&quot;) { Source = this });
                return templateModelView;
            }

            if (model is LayoutDocumentPane)
            {
                var templateModelView = new LayoutDocumentPaneControl(model as LayoutDocumentPane);
                templateModelView.SetBinding(LayoutDocumentPaneControl.StyleProperty, new Binding(&quot;DocumentPaneControlStyle&quot;) { Source = this });
                return templateModelView;
            }
            if (model is LayoutAnchorablePane)
            {
                var templateModelView = new LayoutAnchorablePaneControl(model as LayoutAnchorablePane);
                templateModelView.SetBinding(LayoutAnchorablePaneControl.StyleProperty, new Binding(&quot;AnchorablePaneControlStyle&quot;) { Source = this });
                return templateModelView;
            }

            if (model is LayoutAnchorableFloatingWindow)
            {
                if (DesignerProperties.GetIsInDesignMode(this))
                    return null;
                var modelFW = model as LayoutAnchorableFloatingWindow;
                var newFW = new LayoutAnchorableFloatingWindowControl(modelFW)
                {
                    //Owner = Window.GetWindow(this) 
                };
                newFW.SetParentToMainWindowOf(this);

                var paneForExtensions = modelFW.RootPanel.Children.OfType&lt;LayoutAnchorablePane&gt;().FirstOrDefault();
                if (paneForExtensions != null)
                {
                    //ensure that floating window position is inside current (or nearest) monitor
                    paneForExtensions.KeepInsideNearestMonitor();

                    newFW.Left = paneForExtensions.FloatingLeft;
                    newFW.Top = paneForExtensions.FloatingTop;
                    newFW.Width = paneForExtensions.FloatingWidth;
                    newFW.Height = paneForExtensions.FloatingHeight;
                }

                newFW.ShowInTaskbar = false;
                newFW.Show();
                // Do not set the WindowState before showing or it will be lost
                if( paneForExtensions != null &amp;&amp; paneForExtensions.IsMaximized )
                {
                  newFW.WindowState = WindowState.Maximized;
                }
                return newFW;
            }

            if (model is LayoutDocumentFloatingWindow)
            {
                if (DesignerProperties.GetIsInDesignMode(this))
                    return null;
                var modelFW = model as LayoutDocumentFloatingWindow;
                var newFW = new LayoutDocumentFloatingWindowControl(modelFW)
                {
                    //Owner = Window.GetWindow(this) 
                };
                newFW.SetParentToMainWindowOf(this);

                var paneForExtensions = modelFW.RootDocument;
                if (paneForExtensions != null)
                {
                    //ensure that floating window position is inside current (or nearest) monitor
                    paneForExtensions.KeepInsideNearestMonitor();

                    newFW.Left = paneForExtensions.FloatingLeft;
                    newFW.Top = paneForExtensions.FloatingTop;
                    newFW.Width = paneForExtensions.FloatingWidth;
                    newFW.Height = paneForExtensions.FloatingHeight;
                }

                newFW.ShowInTaskbar = false;
                newFW.Show();
                // Do not set the WindowState before showing or it will be lost
                if( paneForExtensions != null &amp;&amp; paneForExtensions.IsMaximized )
                {
                  newFW.WindowState = WindowState.Maximized;
                }
                return newFW;
            }

            if (model is LayoutDocument)
            {
                var templateModelView = new LayoutDocumentControl() { Model = model as LayoutDocument };
                return templateModelView;
            }

            return null;
        }



        #region DocumentPaneTemplate

        /// &lt;summary&gt;
        /// DocumentPaneTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentPaneTemplateProperty =
            DependencyProperty.Register(&quot;DocumentPaneTemplate&quot;, typeof(ControlTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((ControlTemplate)null,
                    new PropertyChangedCallback(OnDocumentPaneTemplateChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentPaneDataTemplate property.  This dependency property 
        /// indicates .
        /// &lt;/summary&gt;
        public ControlTemplate DocumentPaneTemplate
        {
            get { return (ControlTemplate)GetValue(DocumentPaneTemplateProperty); }
            set { SetValue(DocumentPaneTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentPaneTemplate property.
        /// &lt;/summary&gt;
        private static void OnDocumentPaneTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentPaneTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentPaneTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentPaneTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        #endregion

        #region AnchorablePaneTemplate

        /// &lt;summary&gt;
        /// AnchorablePaneTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorablePaneTemplateProperty =
            DependencyProperty.Register(&quot;AnchorablePaneTemplate&quot;, typeof(ControlTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((ControlTemplate)null,
                    new PropertyChangedCallback(OnAnchorablePaneTemplateChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorablePaneTemplate property.  This dependency property 
        /// indicates ....
        /// &lt;/summary&gt;
        public ControlTemplate AnchorablePaneTemplate
        {
            get { return (ControlTemplate)GetValue(AnchorablePaneTemplateProperty); }
            set { SetValue(AnchorablePaneTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorablePaneDataTemplate property.
        /// &lt;/summary&gt;
        private static void OnAnchorablePaneTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorablePaneTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorablePaneDataTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorablePaneTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        #endregion

        #region AnchorSideTemplate

        /// &lt;summary&gt;
        /// AnchorSideTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorSideTemplateProperty =
            DependencyProperty.Register(&quot;AnchorSideTemplate&quot;, typeof(ControlTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((ControlTemplate)null));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorSideTemplate property.  This dependency property 
        /// indicates ....
        /// &lt;/summary&gt;
        public ControlTemplate AnchorSideTemplate
        {
            get { return (ControlTemplate)GetValue(AnchorSideTemplateProperty); }
            set { SetValue(AnchorSideTemplateProperty, value); }
        }

        #endregion

        #region AnchorGroupTemplate

        /// &lt;summary&gt;
        /// AnchorGroupTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorGroupTemplateProperty =
            DependencyProperty.Register(&quot;AnchorGroupTemplate&quot;, typeof(ControlTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((ControlTemplate)null));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorGroupTemplate property.  This dependency property 
        /// indicates the template used to render the AnchorGroup control.
        /// &lt;/summary&gt;
        public ControlTemplate AnchorGroupTemplate
        {
            get { return (ControlTemplate)GetValue(AnchorGroupTemplateProperty); }
            set { SetValue(AnchorGroupTemplateProperty, value); }
        }

        #endregion

        #region AnchorTemplate

        /// &lt;summary&gt;
        /// AnchorTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorTemplateProperty =
            DependencyProperty.Register(&quot;AnchorTemplate&quot;, typeof(ControlTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((ControlTemplate)null));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorTemplate property.  This dependency property 
        /// indicates ....
        /// &lt;/summary&gt;
        public ControlTemplate AnchorTemplate
        {
            get { return (ControlTemplate)GetValue(AnchorTemplateProperty); }
            set { SetValue(AnchorTemplateProperty, value); }
        }

        #endregion

        #region DocumentPaneControlStyle

        /// &lt;summary&gt;
        /// DocumentPaneControlStyle Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentPaneControlStyleProperty =
            DependencyProperty.Register(&quot;DocumentPaneControlStyle&quot;, typeof(Style), typeof(DockingManager),
                new FrameworkPropertyMetadata((Style)null,
                    new PropertyChangedCallback(OnDocumentPaneControlStyleChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentPaneControlStyle property.  This dependency property 
        /// indicates ....
        /// &lt;/summary&gt;
        public Style DocumentPaneControlStyle
        {
            get { return (Style)GetValue(DocumentPaneControlStyleProperty); }
            set { SetValue(DocumentPaneControlStyleProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentPaneControlStyle property.
        /// &lt;/summary&gt;
        private static void OnDocumentPaneControlStyleChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentPaneControlStyleChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentPaneControlStyle property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentPaneControlStyleChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        #endregion

        #region AnchorablePaneControlStyle

        /// &lt;summary&gt;
        /// AnchorablePaneControlStyle Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorablePaneControlStyleProperty =
            DependencyProperty.Register(&quot;AnchorablePaneControlStyle&quot;, typeof(Style), typeof(DockingManager),
                new FrameworkPropertyMetadata((Style)null,
                    new PropertyChangedCallback(OnAnchorablePaneControlStyleChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorablePaneControlStyle property.  This dependency property 
        /// indicates the style to apply to AnchorablePaneControl.
        /// &lt;/summary&gt;
        public Style AnchorablePaneControlStyle
        {
            get { return (Style)GetValue(AnchorablePaneControlStyleProperty); }
            set { SetValue(AnchorablePaneControlStyleProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorablePaneControlStyle property.
        /// &lt;/summary&gt;
        private static void OnAnchorablePaneControlStyleChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorablePaneControlStyleChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorablePaneControlStyle property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorablePaneControlStyleChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        #endregion

        #region DocumentHeaderTemplate

        /// &lt;summary&gt;
        /// DocumentHeaderTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentHeaderTemplateProperty =
            DependencyProperty.Register(&quot;DocumentHeaderTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null,
                    new PropertyChangedCallback(OnDocumentHeaderTemplateChanged),
                    new CoerceValueCallback(CoerceDocumentHeaderTemplateValue)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentHeaderTemplate property.  This dependency property 
        /// indicates data template to use for document header.
        /// &lt;/summary&gt;
        public DataTemplate DocumentHeaderTemplate
        {
            get { return (DataTemplate)GetValue(DocumentHeaderTemplateProperty); }
            set { SetValue(DocumentHeaderTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentHeaderTemplate property.
        /// &lt;/summary&gt;
        private static void OnDocumentHeaderTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentHeaderTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentHeaderTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentHeaderTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        /// &lt;summary&gt;
        /// Coerces the DocumentHeaderTemplate value.
        /// &lt;/summary&gt;
        private static object CoerceDocumentHeaderTemplateValue(DependencyObject d, object value)
        {
            if (value != null &amp;&amp;
                d.GetValue(DocumentHeaderTemplateSelectorProperty) != null)
                return null;
            return value;
        }

        #endregion

        #region DocumentHeaderTemplateSelector

        /// &lt;summary&gt;
        /// DocumentHeaderTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentHeaderTemplateSelectorProperty =
            DependencyProperty.Register(&quot;DocumentHeaderTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null,
                    new PropertyChangedCallback(OnDocumentHeaderTemplateSelectorChanged),
                    new CoerceValueCallback(CoerceDocumentHeaderTemplateSelectorValue)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentHeaderTemplateSelector property.  This dependency property 
        /// indicates the template selector that is used when selcting the data template for the header.
        /// &lt;/summary&gt;
        public DataTemplateSelector DocumentHeaderTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(DocumentHeaderTemplateSelectorProperty); }
            set { SetValue(DocumentHeaderTemplateSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentHeaderTemplateSelector property.
        /// &lt;/summary&gt;
        private static void OnDocumentHeaderTemplateSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentHeaderTemplateSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentHeaderTemplateSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentHeaderTemplateSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.NewValue != null &amp;&amp;
                DocumentHeaderTemplate != null)
                DocumentHeaderTemplate = null;

            if (DocumentPaneMenuItemHeaderTemplateSelector == null)
                DocumentPaneMenuItemHeaderTemplateSelector = DocumentHeaderTemplateSelector;

        }

        /// &lt;summary&gt;
        /// Coerces the DocumentHeaderTemplateSelector value.
        /// &lt;/summary&gt;
        private static object CoerceDocumentHeaderTemplateSelectorValue(DependencyObject d, object value)
        {
            return value;
        }

        #endregion

        #region DocumentTitleTemplate

        /// &lt;summary&gt;
        /// DocumentTitleTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentTitleTemplateProperty =
            DependencyProperty.Register(&quot;DocumentTitleTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null,
                    new PropertyChangedCallback(OnDocumentTitleTemplateChanged),
                    new CoerceValueCallback(CoerceDocumentTitleTemplateValue)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentTitleTemplate property.  This dependency property 
        /// indicates the datatemplate to use when creating the title for a document.
        /// &lt;/summary&gt;
        public DataTemplate DocumentTitleTemplate
        {
            get { return (DataTemplate)GetValue(DocumentTitleTemplateProperty); }
            set { SetValue(DocumentTitleTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentTitleTemplate property.
        /// &lt;/summary&gt;
        private static void OnDocumentTitleTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentTitleTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentTitleTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentTitleTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        /// &lt;summary&gt;
        /// Coerces the DocumentTitleTemplate value.
        /// &lt;/summary&gt;
        private static object CoerceDocumentTitleTemplateValue(DependencyObject d, object value)
        {
            if (value != null &amp;&amp;
                d.GetValue(DocumentTitleTemplateSelectorProperty) != null)
                return null;

            return value;
        }

        #endregion

        #region DocumentTitleTemplateSelector

        /// &lt;summary&gt;
        /// DocumentTitleTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentTitleTemplateSelectorProperty =
            DependencyProperty.Register(&quot;DocumentTitleTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null,
                    new PropertyChangedCallback(OnDocumentTitleTemplateSelectorChanged),
                    new CoerceValueCallback(CoerceDocumentTitleTemplateSelectorValue)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentTitleTemplateSelector property.  This dependency property 
        /// indicates the data template selector to use when creating the data template for the title.
        /// &lt;/summary&gt;
        public DataTemplateSelector DocumentTitleTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(DocumentTitleTemplateSelectorProperty); }
            set { SetValue(DocumentTitleTemplateSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentTitleTemplateSelector property.
        /// &lt;/summary&gt;
        private static void OnDocumentTitleTemplateSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentTitleTemplateSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentTitleTemplateSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentTitleTemplateSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.NewValue != null)
                DocumentTitleTemplate = null;                
        }

        /// &lt;summary&gt;
        /// Coerces the DocumentTitleTemplateSelector value.
        /// &lt;/summary&gt;
        private static object CoerceDocumentTitleTemplateSelectorValue(DependencyObject d, object value)
        {
            return value;
        }

        #endregion

        #region AnchorableTitleTemplate

        /// &lt;summary&gt;
        /// AnchorableTitleTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorableTitleTemplateProperty =
            DependencyProperty.Register(&quot;AnchorableTitleTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null,
                    new PropertyChangedCallback(OnAnchorableTitleTemplateChanged),
                    new CoerceValueCallback(CoerceAnchorableTitleTemplateValue)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorableTitleTemplate property.  This dependency property 
        /// indicates the data template to use for anchorables title.
        /// &lt;/summary&gt;
        public DataTemplate AnchorableTitleTemplate
        {
            get { return (DataTemplate)GetValue(AnchorableTitleTemplateProperty); }
            set { SetValue(AnchorableTitleTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorableTitleTemplate property.
        /// &lt;/summary&gt;
        private static void OnAnchorableTitleTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorableTitleTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorableTitleTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorableTitleTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        /// &lt;summary&gt;
        /// Coerces the AnchorableTitleTemplate value.
        /// &lt;/summary&gt;
        private static object CoerceAnchorableTitleTemplateValue(DependencyObject d, object value)
        {
            if (value != null &amp;&amp;
                d.GetValue(AnchorableTitleTemplateSelectorProperty) != null)
                return null;
            return value;
        }

        #endregion

        #region AnchorableTitleTemplateSelector

        /// &lt;summary&gt;
        /// AnchorableTitleTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorableTitleTemplateSelectorProperty =
            DependencyProperty.Register(&quot;AnchorableTitleTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null,
                    new PropertyChangedCallback(OnAnchorableTitleTemplateSelectorChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorableTitleTemplateSelector property.  This dependency property 
        /// indicates selctor to use when selecting data template for the title of anchorables.
        /// &lt;/summary&gt;
        public DataTemplateSelector AnchorableTitleTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(AnchorableTitleTemplateSelectorProperty); }
            set { SetValue(AnchorableTitleTemplateSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorableTitleTemplateSelector property.
        /// &lt;/summary&gt;
        private static void OnAnchorableTitleTemplateSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorableTitleTemplateSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorableTitleTemplateSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorableTitleTemplateSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.NewValue != null &amp;&amp;
                AnchorableTitleTemplate != null)
                AnchorableTitleTemplate = null;
        }

        #endregion

        #region AnchorableHeaderTemplate

        /// &lt;summary&gt;
        /// AnchorableHeaderTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorableHeaderTemplateProperty =
            DependencyProperty.Register(&quot;AnchorableHeaderTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null,
                    new PropertyChangedCallback(OnAnchorableHeaderTemplateChanged),
                    new CoerceValueCallback(CoerceAnchorableHeaderTemplateValue)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorableHeaderTemplate property.  This dependency property 
        /// indicates the data template to use for anchorable templates.
        /// &lt;/summary&gt;
        public DataTemplate AnchorableHeaderTemplate
        {
            get { return (DataTemplate)GetValue(AnchorableHeaderTemplateProperty); }
            set { SetValue(AnchorableHeaderTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorableHeaderTemplate property.
        /// &lt;/summary&gt;
        private static void OnAnchorableHeaderTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorableHeaderTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorableHeaderTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorableHeaderTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        /// &lt;summary&gt;
        /// Coerces the AnchorableHeaderTemplate value.
        /// &lt;/summary&gt;
        private static object CoerceAnchorableHeaderTemplateValue(DependencyObject d, object value)
        {
            if (value != null &amp;&amp;
                d.GetValue(AnchorableHeaderTemplateSelectorProperty) != null)
                return null;

            return value;
        }

        #endregion

        #region AnchorableHeaderTemplateSelector

        /// &lt;summary&gt;
        /// AnchorableHeaderTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorableHeaderTemplateSelectorProperty =
            DependencyProperty.Register(&quot;AnchorableHeaderTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null,
                    new PropertyChangedCallback(OnAnchorableHeaderTemplateSelectorChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorableHeaderTemplateSelector property.  This dependency property 
        /// indicates the selector to use when selecting the data template for anchorable headers.
        /// &lt;/summary&gt;
        public DataTemplateSelector AnchorableHeaderTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(AnchorableHeaderTemplateSelectorProperty); }
            set { SetValue(AnchorableHeaderTemplateSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorableHeaderTemplateSelector property.
        /// &lt;/summary&gt;
        private static void OnAnchorableHeaderTemplateSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorableHeaderTemplateSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorableHeaderTemplateSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorableHeaderTemplateSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.NewValue != null)
                AnchorableHeaderTemplate = null;
        }

        #endregion

        protected override void OnGotKeyboardFocus(System.Windows.Input.KeyboardFocusChangedEventArgs e)
        {
            //if (e.NewFocus is Grid)
          //    Trace.WriteLine(string.Format(&quot;DockingManager.OnGotKeyboardFocus({0})&quot;, e.NewFocus));
            base.OnGotKeyboardFocus(e);
        }

        protected override void OnPreviewGotKeyboardFocus(System.Windows.Input.KeyboardFocusChangedEventArgs e)
        {
          Trace.WriteLine( string.Format( &quot;DockingManager.OnPreviewGotKeyboardFocus({0})&quot;, e.NewFocus ) );

            base.OnPreviewGotKeyboardFocus(e);
        }

        protected override void OnPreviewLostKeyboardFocus(KeyboardFocusChangedEventArgs e)
        {
          Trace.WriteLine( string.Format( &quot;DockingManager.OnPreviewLostKeyboardFocus({0})&quot;, e.OldFocus ) );
            base.OnPreviewLostKeyboardFocus(e);
        }

        protected override void OnMouseLeftButtonDown(System.Windows.Input.MouseButtonEventArgs e)
        {
          Trace.WriteLine( string.Format( &quot;DockingManager.OnMouseLeftButtonDown([{0}])&quot;, e.GetPosition( this ) ) );
            base.OnMouseLeftButtonDown(e);
        }

        protected override void OnMouseMove(System.Windows.Input.MouseEventArgs e)
        {
          //Trace.WriteLine(string.Format(&quot;DockingManager.OnMouseMove([{0}])&quot;, e.GetPosition(this)));
            base.OnMouseMove(e);
        }



        #region LayoutRootPanel

        /// &lt;summary&gt;
        /// LayoutRootPanel Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutRootPanelProperty =
            DependencyProperty.Register(&quot;LayoutRootPanel&quot;, typeof(LayoutPanelControl), typeof(DockingManager),
                new FrameworkPropertyMetadata((LayoutPanelControl)null,
                    new PropertyChangedCallback(OnLayoutRootPanelChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the LayoutRootPanel property.  This dependency property 
        /// indicates the layout panel control which is attached to the Layout.Root property.
        /// &lt;/summary&gt;
        public LayoutPanelControl LayoutRootPanel
        {
            get { return (LayoutPanelControl)GetValue(LayoutRootPanelProperty); }
            set { SetValue(LayoutRootPanelProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the LayoutRootPanel property.
        /// &lt;/summary&gt;
        private static void OnLayoutRootPanelChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLayoutRootPanelChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the LayoutRootPanel property.
        /// &lt;/summary&gt;
        protected virtual void OnLayoutRootPanelChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.OldValue != null)
                InternalRemoveLogicalChild(e.OldValue);
            if (e.NewValue != null)
                InternalAddLogicalChild(e.NewValue);
        }

        #endregion

        #region RightSidePanel

        /// &lt;summary&gt;
        /// RightSidePanel Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty RightSidePanelProperty =
            DependencyProperty.Register(&quot;RightSidePanel&quot;, typeof(LayoutAnchorSideControl), typeof(DockingManager),
                new FrameworkPropertyMetadata((LayoutAnchorSideControl)null,
                    new PropertyChangedCallback(OnRightSidePanelChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the RightSidePanel property.  This dependency property 
        /// indicates right side anchor panel.
        /// &lt;/summary&gt;
        public LayoutAnchorSideControl RightSidePanel
        {
            get { return (LayoutAnchorSideControl)GetValue(RightSidePanelProperty); }
            set { SetValue(RightSidePanelProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the RightSidePanel property.
        /// &lt;/summary&gt;
        private static void OnRightSidePanelChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnRightSidePanelChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the RightSidePanel property.
        /// &lt;/summary&gt;
        protected virtual void OnRightSidePanelChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.OldValue != null)
                InternalRemoveLogicalChild(e.OldValue);
            if (e.NewValue != null)
                InternalAddLogicalChild(e.NewValue);
        }

        #endregion

        #region LeftSidePanel

        /// &lt;summary&gt;
        /// LeftSidePanel Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LeftSidePanelProperty =
            DependencyProperty.Register(&quot;LeftSidePanel&quot;, typeof(LayoutAnchorSideControl), typeof(DockingManager),
                new FrameworkPropertyMetadata((LayoutAnchorSideControl)null,
                    new PropertyChangedCallback(OnLeftSidePanelChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the LeftSidePanel property.  This dependency property 
        /// indicates the left side panel control.
        /// &lt;/summary&gt;
        public LayoutAnchorSideControl LeftSidePanel
        {
            get { return (LayoutAnchorSideControl)GetValue(LeftSidePanelProperty); }
            set { SetValue(LeftSidePanelProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the LeftSidePanel property.
        /// &lt;/summary&gt;
        private static void OnLeftSidePanelChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLeftSidePanelChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the LeftSidePanel property.
        /// &lt;/summary&gt;
        protected virtual void OnLeftSidePanelChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.OldValue != null)
                InternalRemoveLogicalChild(e.OldValue);
            if (e.NewValue != null)
                InternalAddLogicalChild(e.NewValue);
        }

        #endregion

        #region TopSidePanel

        /// &lt;summary&gt;
        /// TopSidePanel Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty TopSidePanelProperty =
            DependencyProperty.Register(&quot;TopSidePanel&quot;, typeof(LayoutAnchorSideControl), typeof(DockingManager),
                new FrameworkPropertyMetadata((LayoutAnchorSideControl)null,
                    new PropertyChangedCallback(OnTopSidePanelChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the TopSidePanel property.  This dependency property 
        /// indicates top side control panel.
        /// &lt;/summary&gt;
        public LayoutAnchorSideControl TopSidePanel
        {
            get { return (LayoutAnchorSideControl)GetValue(TopSidePanelProperty); }
            set { SetValue(TopSidePanelProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the TopSidePanel property.
        /// &lt;/summary&gt;
        private static void OnTopSidePanelChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnTopSidePanelChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the TopSidePanel property.
        /// &lt;/summary&gt;
        protected virtual void OnTopSidePanelChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.OldValue != null)
                InternalRemoveLogicalChild(e.OldValue);
            if (e.NewValue != null)
                InternalAddLogicalChild(e.NewValue);
        }

        #endregion

        #region BottomSidePanel

        /// &lt;summary&gt;
        /// BottomSidePanel Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty BottomSidePanelProperty =
            DependencyProperty.Register(&quot;BottomSidePanel&quot;, typeof(LayoutAnchorSideControl), typeof(DockingManager),
                new FrameworkPropertyMetadata((LayoutAnchorSideControl)null,
                    new PropertyChangedCallback(OnBottomSidePanelChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the BottomSidePanel property.  This dependency property 
        /// indicates bottom side panel control.
        /// &lt;/summary&gt;
        public LayoutAnchorSideControl BottomSidePanel
        {
            get { return (LayoutAnchorSideControl)GetValue(BottomSidePanelProperty); }
            set { SetValue(BottomSidePanelProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the BottomSidePanel property.
        /// &lt;/summary&gt;
        private static void OnBottomSidePanelChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnBottomSidePanelChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the BottomSidePanel property.
        /// &lt;/summary&gt;
        protected virtual void OnBottomSidePanelChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.OldValue != null)
                InternalRemoveLogicalChild(e.OldValue);
            if (e.NewValue != null)
                InternalAddLogicalChild(e.NewValue);
        }

        #endregion


        #region LogicalChildren

        List&lt;WeakReference&gt; _logicalChildren = new List&lt;WeakReference&gt;();

        protected override System.Collections.IEnumerator LogicalChildren
        {
            get
            {
                return _logicalChildren.Select(ch =&gt; ch.GetValueOrDefault&lt;object&gt;()).GetEnumerator();
            }
        }


        internal void InternalAddLogicalChild(object element)
        {
          //System.Diagnostics.Trace.WriteLine(&quot;[{0}]InternalAddLogicalChild({1})&quot;, this, element);
#if DEBUG
            if (_logicalChildren.Select(ch =&gt; ch.GetValueOrDefault&lt;object&gt;()).Contains(element))
                new InvalidOperationException();
#endif
            if (_logicalChildren.Select(ch =&gt; ch.GetValueOrDefault&lt;object&gt;()).Contains(element))
                return;

            _logicalChildren.Add(new WeakReference(element));
            AddLogicalChild(element);
        }

        internal void InternalRemoveLogicalChild(object element)
        {
          //System.Diagnostics.Trace.WriteLine(&quot;[{0}]InternalRemoveLogicalChild({1})&quot;, this, element);

            var wrToRemove = _logicalChildren.FirstOrDefault(ch =&gt; ch.GetValueOrDefault&lt;object&gt;() == element);
            if (wrToRemove != null)
                _logicalChildren.Remove(wrToRemove);
            RemoveLogicalChild(element);
        }

        void ClearLogicalChildrenList()
        {
            foreach (var child in _logicalChildren.Select(ch =&gt; ch.GetValueOrDefault&lt;object&gt;()).ToArray())
                RemoveLogicalChild(child);
            _logicalChildren.Clear();
        }

        #endregion  

        #region AutoHide window
        internal void ShowAutoHideWindow(LayoutAnchorControl anchor)
        {
            _autoHideWindowManager.ShowAutoHideWindow(anchor);
            //if (_autohideArea == null)
            //    return;

            //if (AutoHideWindow != null &amp;&amp; AutoHideWindow.Model == anchor.Model)
            //    return;

          //Trace.WriteLine(&quot;ShowAutoHideWindow()&quot;);

            //_currentAutohiddenAnchor = new WeakReference(anchor);

            //HideAutoHideWindow(anchor);

            //SetAutoHideWindow(new LayoutAutoHideWindowControl(anchor));
            //AutoHideWindow.Show();
        }

        internal void HideAutoHideWindow(LayoutAnchorControl anchor)
        {
            _autoHideWindowManager.HideAutoWindow(anchor);
        }


        void SetupAutoHideWindow()
        {
            _autohideArea = GetTemplateChild(&quot;PART_AutoHideArea&quot;) as FrameworkElement;

            if (_autoHideWindowManager != null)
                _autoHideWindowManager.HideAutoWindow();
            else
                _autoHideWindowManager = new AutoHideWindowManager(this);

            if (AutoHideWindow != null)
                AutoHideWindow.Dispose();

            SetAutoHideWindow(new LayoutAutoHideWindowControl());
        }

        AutoHideWindowManager _autoHideWindowManager;

        FrameworkElement _autohideArea;
        internal FrameworkElement GetAutoHideAreaElement()
        {
            return _autohideArea;
        }

        #region AutoHideWindow

        /// &lt;summary&gt;
        /// AutoHideWindow Read-Only Dependency Property
        /// &lt;/summary&gt;
        private static readonly DependencyPropertyKey AutoHideWindowPropertyKey
            = DependencyProperty.RegisterReadOnly(&quot;AutoHideWindow&quot;, typeof(LayoutAutoHideWindowControl), typeof(DockingManager),
                new FrameworkPropertyMetadata((LayoutAutoHideWindowControl)null,
                    new PropertyChangedCallback(OnAutoHideWindowChanged)));

        public static readonly DependencyProperty AutoHideWindowProperty
            = AutoHideWindowPropertyKey.DependencyProperty;

        /// &lt;summary&gt;
        /// Gets the AutoHideWindow property.  This dependency property 
        /// indicates the currently shown autohide window.
        /// &lt;/summary&gt;
        public LayoutAutoHideWindowControl AutoHideWindow
        {
            get { return (LayoutAutoHideWindowControl)GetValue(AutoHideWindowProperty); }
        }

        /// &lt;summary&gt;
        /// Provides a secure method for setting the AutoHideWindow property.  
        /// This dependency property indicates the currently shown autohide window.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;value&quot;&gt;The new value for the property.&lt;/param&gt;
        protected void SetAutoHideWindow(LayoutAutoHideWindowControl value)
        {
            SetValue(AutoHideWindowPropertyKey, value);
        }

        /// &lt;summary&gt;
        /// Handles changes to the AutoHideWindow property.
        /// &lt;/summary&gt;
        private static void OnAutoHideWindowChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAutoHideWindowChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AutoHideWindow property.
        /// &lt;/summary&gt;
        protected virtual void OnAutoHideWindowChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.OldValue != null)
                InternalRemoveLogicalChild(e.OldValue);
            if (e.NewValue != null)
                InternalAddLogicalChild(e.NewValue);

        }

        #endregion



        #endregion
        // #region AutoHide window
        //WeakReference _currentAutohiddenAnchor = null;
        //internal void ShowAutoHideWindow(LayoutAnchorControl anchor)
        //{
        //    if (_autohideArea == null)
        //        return;

        //    if (AutoHideWindow != null &amp;&amp; AutoHideWindow.Model == anchor.Model)
        //        return;

        //    Trace.WriteLine(&quot;ShowAutoHideWindow()&quot;);

        //    _currentAutohiddenAnchor = new WeakReference(anchor);

        //    HideAutoHideWindow(anchor);

        //    SetAutoHideWindow(new LayoutAutoHideWindowControl(anchor));
        //}

        //internal void HideAutoHideWindow(LayoutAnchorControl anchor)
        //{
        //    if (AutoHideWindow != null)
        //    {
        //        if (anchor == _currentAutohiddenAnchor.GetValueOrDefault&lt;LayoutAnchorControl&gt;())
        //        {
        //            Trace.WriteLine(&quot;AutoHideWindow()&quot;);
        //            AutoHideWindow.Dispose();
        //            SetAutoHideWindow(null);
        //        }
        //    }
        //}

        //FrameworkElement _autohideArea;
        //internal FrameworkElement GetAutoHideAreaElement()
        //{
        //    return _autohideArea;
        //}

        //void SetupAutoHideArea()
        //{
        //    _autohideArea = GetTemplateChild(&quot;PART_AutoHideArea&quot;) as FrameworkElement;
        //}

        // #region AutoHideWindow

        ///// &lt;summary&gt;
        ///// AutoHideWindow Read-Only Dependency Property
        ///// &lt;/summary&gt;
        //private static readonly DependencyPropertyKey AutoHideWindowPropertyKey
        //    = DependencyProperty.RegisterReadOnly(&quot;AutoHideWindow&quot;, typeof(LayoutAutoHideWindowControl), typeof(DockingManager),
        //        new FrameworkPropertyMetadata((LayoutAutoHideWindowControl)null,
        //            new PropertyChangedCallback(OnAutoHideWindowChanged)));

        //public static readonly DependencyProperty AutoHideWindowProperty
        //    = AutoHideWindowPropertyKey.DependencyProperty;

        ///// &lt;summary&gt;
        ///// Gets the AutoHideWindow property.  This dependency property 
        ///// indicates the currently shown autohide window.
        ///// &lt;/summary&gt;
        //public LayoutAutoHideWindowControl AutoHideWindow
        //{
        //    get { return (LayoutAutoHideWindowControl)GetValue(AutoHideWindowProperty); }
        //}

        ///// &lt;summary&gt;
        ///// Provides a secure method for setting the AutoHideWindow property.  
        ///// This dependency property indicates the currently shown autohide window.
        ///// &lt;/summary&gt;
        ///// &lt;param name=&quot;value&quot;&gt;The new value for the property.&lt;/param&gt;
        //protected void SetAutoHideWindow(LayoutAutoHideWindowControl value)
        //{
        //    SetValue(AutoHideWindowPropertyKey, value);
        //}

        ///// &lt;summary&gt;
        ///// Handles changes to the AutoHideWindow property.
        ///// &lt;/summary&gt;
        //private static void OnAutoHideWindowChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        //{
        //    ((DockingManager)d).OnAutoHideWindowChanged(e);
        //}

        ///// &lt;summary&gt;
        ///// Provides derived classes an opportunity to handle changes to the AutoHideWindow property.
        ///// &lt;/summary&gt;
        //protected virtual void OnAutoHideWindowChanged(DependencyPropertyChangedEventArgs e)
        //{
        //    if (e.OldValue != null)
        //        ((ILogicalChildrenContainer)this).InternalRemoveLogicalChild(e.OldValue);
        //    if (e.NewValue != null)
        //        ((ILogicalChildrenContainer)this).InternalAddLogicalChild(e.NewValue);
        //}

        // #endregion



        // #endregion

        #region Floating Windows
        List&lt;LayoutFloatingWindowControl&gt; _fwList = new List&lt;LayoutFloatingWindowControl&gt;();

        internal void StartDraggingFloatingWindowForContent(LayoutContent contentModel, bool startDrag = true)
        {
            if (!contentModel.CanFloat)
                return;
            var contentModelAsAnchorable = contentModel as LayoutAnchorable;
            if (contentModelAsAnchorable != null &amp;&amp;
                contentModelAsAnchorable.IsAutoHidden)
                contentModelAsAnchorable.ToggleAutoHide();

            var parentPane = contentModel.Parent as ILayoutPane;
            var parentPaneAsPositionableElement = contentModel.Parent as ILayoutPositionableElement;
            var parentPaneAsWithActualSize = contentModel.Parent as ILayoutPositionableElementWithActualSize;
            var contentModelParentChildrenIndex = parentPane.Children.ToList().IndexOf(contentModel);

            if (contentModel.FindParent&lt;LayoutFloatingWindow&gt;() == null)
            {
                ((ILayoutPreviousContainer)contentModel).PreviousContainer = parentPane;
                contentModel.PreviousContainerIndex = contentModelParentChildrenIndex;
            }

            parentPane.RemoveChildAt(contentModelParentChildrenIndex);

            double fwWidth = contentModel.FloatingWidth; 
            double fwHeight = contentModel.FloatingHeight; 

            if (fwWidth == 0.0)
                fwWidth = parentPaneAsPositionableElement.FloatingWidth;
            if (fwHeight == 0.0)
                fwHeight = parentPaneAsPositionableElement.FloatingHeight;

            if (fwWidth == 0.0)
                fwWidth = parentPaneAsWithActualSize.ActualWidth;
            if (fwHeight == 0.0)
                fwHeight = parentPaneAsWithActualSize.ActualHeight;

            LayoutFloatingWindow fw;
            LayoutFloatingWindowControl fwc;
            if (contentModel is LayoutAnchorable)
            {
                var anchorableContent = contentModel as LayoutAnchorable;
                fw = new LayoutAnchorableFloatingWindow()
                {
                    RootPanel = new LayoutAnchorablePaneGroup(
                        new LayoutAnchorablePane(anchorableContent)
                        {
                            DockWidth = parentPaneAsPositionableElement.DockWidth,
                            DockHeight = parentPaneAsPositionableElement.DockHeight,
                            DockMinHeight = parentPaneAsPositionableElement.DockMinHeight,
                            DockMinWidth = parentPaneAsPositionableElement.DockMinWidth,
                            FloatingLeft = parentPaneAsPositionableElement.FloatingLeft,
                            FloatingTop = parentPaneAsPositionableElement.FloatingTop,
                            FloatingWidth = parentPaneAsPositionableElement.FloatingWidth,
                            FloatingHeight = parentPaneAsPositionableElement.FloatingHeight,
                        }),
                };

                Layout.FloatingWindows.Add(fw);
                fwc = new LayoutAnchorableFloatingWindowControl(
                    fw as LayoutAnchorableFloatingWindow)
                    {
						FontSize = FontSize,
                        Width = fwWidth,
                        Height = fwHeight,
                        Left = contentModel.FloatingLeft,
                        Top = contentModel.FloatingTop
                    };
            }
            else
            {
                var anchorableDocument = contentModel as LayoutDocument;
                fw = new LayoutDocumentFloatingWindow()
                {
                    RootDocument = anchorableDocument
                };

                Layout.FloatingWindows.Add(fw);

                fwc = new LayoutDocumentFloatingWindowControl(
                    fw as LayoutDocumentFloatingWindow)
                {
                    Width = fwWidth,
                    Height = fwHeight,
                    Left = contentModel.FloatingLeft,
                    Top = contentModel.FloatingTop
                };
            }


            //fwc.Owner = Window.GetWindow(this);
            //fwc.SetParentToMainWindowOf(this);


            _fwList.Add(fwc);

            Layout.CollectGarbage();

            UpdateLayout();

            Dispatcher.BeginInvoke(new Action(() =&gt;
            {
                if (startDrag)
                    fwc.AttachDrag();
                fwc.Show();
            }), DispatcherPriority.Send);
        }

        internal void StartDraggingFloatingWindowForPane(LayoutAnchorablePane paneModel)
        {
            if (paneModel.Children.Any(c =&gt; !c.CanFloat))
                return;
            var paneAsPositionableElement = paneModel as ILayoutPositionableElement;
            var paneAsWithActualSize = paneModel as ILayoutPositionableElementWithActualSize;

            double fwWidth = paneAsPositionableElement.FloatingWidth;
            double fwHeight = paneAsPositionableElement.FloatingHeight;
            double fwLeft = paneAsPositionableElement.FloatingLeft;
            double fwTop = paneAsPositionableElement.FloatingTop;



            if (fwWidth == 0.0)
                fwWidth = paneAsWithActualSize.ActualWidth;
            if (fwHeight == 0.0)
                fwHeight = paneAsWithActualSize.ActualHeight;

            var destPane = new LayoutAnchorablePane()
            {
                DockWidth = paneAsPositionableElement.DockWidth,
                DockHeight = paneAsPositionableElement.DockHeight,
                DockMinHeight = paneAsPositionableElement.DockMinHeight,
                DockMinWidth = paneAsPositionableElement.DockMinWidth,
                FloatingLeft = paneAsPositionableElement.FloatingLeft,
                FloatingTop = paneAsPositionableElement.FloatingTop,
                FloatingWidth = paneAsPositionableElement.FloatingWidth,
                FloatingHeight = paneAsPositionableElement.FloatingHeight,
            };

            bool savePreviousContainer = paneModel.FindParent&lt;LayoutFloatingWindow&gt;() == null;
            int currentSelectedContentIndex = paneModel.SelectedContentIndex;
            while (paneModel.Children.Count &gt; 0)
            {
                var contentModel = paneModel.Children[paneModel.Children.Count - 1] as LayoutAnchorable;

                if (savePreviousContainer)
                {
                    var contentModelAsPreviousContainer = contentModel as ILayoutPreviousContainer;
                    contentModelAsPreviousContainer.PreviousContainer = paneModel;
                    contentModel.PreviousContainerIndex = paneModel.Children.Count - 1;
                }

                paneModel.RemoveChildAt(paneModel.Children.Count - 1);
                destPane.Children.Insert(0, contentModel);
            }

            if (destPane.Children.Count &gt; 0)
            {
                destPane.SelectedContentIndex = currentSelectedContentIndex;
            }


            LayoutFloatingWindow fw;
            LayoutFloatingWindowControl fwc;
            fw = new LayoutAnchorableFloatingWindow()
            {
                RootPanel = new LayoutAnchorablePaneGroup(
                    destPane) 
                    {
                        DockHeight = destPane.DockHeight,
                        DockWidth = destPane.DockWidth,
                        DockMinHeight = destPane.DockMinHeight,
                        DockMinWidth = destPane.DockMinWidth,
                    }
            };

            Layout.FloatingWindows.Add(fw);

            fwc = new LayoutAnchorableFloatingWindowControl(
                fw as LayoutAnchorableFloatingWindow)
            {
                Width = fwWidth,
                Height = fwHeight
            };



            //fwc.Owner = Window.GetWindow(this);
            //fwc.SetParentToMainWindowOf(this);


            _fwList.Add(fwc);

            Layout.CollectGarbage();

            InvalidateArrange();

            fwc.AttachDrag();
            fwc.Show(); 

        }

        internal IEnumerable&lt;LayoutFloatingWindowControl&gt; GetFloatingWindowsByZOrder()
        {
            var parentWindow = Window.GetWindow(this);

            if (parentWindow == null)
                yield break;

            IntPtr windowParentHanlde = new WindowInteropHelper(parentWindow).Handle;

            IntPtr currentHandle = Win32Helper.GetWindow(windowParentHanlde, (uint)Win32Helper.GetWindow_Cmd.GW_HWNDFIRST);
            while (currentHandle != IntPtr.Zero)
            {
                LayoutFloatingWindowControl ctrl = _fwList.FirstOrDefault(fw =&gt; new WindowInteropHelper(fw).Handle == currentHandle);
                if (ctrl != null &amp;&amp; ctrl.Model.Root.Manager == this)
                    yield return ctrl;

                currentHandle = Win32Helper.GetWindow(currentHandle, (uint)Win32Helper.GetWindow_Cmd.GW_HWNDNEXT);
            }
        }

        internal void RemoveFloatingWindow(LayoutFloatingWindowControl floatingWindow)
        {
            _fwList.Remove(floatingWindow);
        }

        public IEnumerable&lt;LayoutFloatingWindowControl&gt; FloatingWindows
        {
            get { return _fwList; }
        }
        #endregion

        #region OverlayWindow

        bool IOverlayWindowHost.HitTest(Point dragPoint)
        {
            Rect detectionRect = new Rect(this.PointToScreenDPIWithoutFlowDirection(new Point()), this.TransformActualSizeToAncestor());
            return detectionRect.Contains(dragPoint);
        }

        DockingManager IOverlayWindowHost.Manager
        {
            get { return this; }
        }

        OverlayWindow _overlayWindow = null;
        void CreateOverlayWindow()
        {
            if (_overlayWindow == null)
            {
                _overlayWindow = new OverlayWindow(this);
            }
            Rect rectWindow = new Rect(this.PointToScreenDPIWithoutFlowDirection(new Point()), this.TransformActualSizeToAncestor());
            _overlayWindow.Left = rectWindow.Left;
            _overlayWindow.Top = rectWindow.Top;
            _overlayWindow.Width = rectWindow.Width;
            _overlayWindow.Height = rectWindow.Height;
        }

        void DestroyOverlayWindow()
        {
            if (_overlayWindow != null)
            {
                _overlayWindow.Close();
                _overlayWindow = null;
            }
        }

        IOverlayWindow IOverlayWindowHost.ShowOverlayWindow(LayoutFloatingWindowControl draggingWindow)
        {
          //Trace.WriteLine(&quot;ShowOverlayWindow&quot;);
            CreateOverlayWindow();
            _overlayWindow.Owner = draggingWindow;
            _overlayWindow.EnableDropTargets();
            _overlayWindow.Show();
            return _overlayWindow;
        }

        void IOverlayWindowHost.HideOverlayWindow()
        {
          //Trace.WriteLine(&quot;HideOverlayWindow&quot;);
            _areas = null;
            _overlayWindow.Owner = null;
            _overlayWindow.HideDropTargets();
        }

        List&lt;IDropArea&gt; _areas = null;

        IEnumerable&lt;IDropArea&gt; IOverlayWindowHost.GetDropAreas(LayoutFloatingWindowControl draggingWindow)
        {
            if (_areas != null)
                return _areas;

            bool isDraggingDocuments = draggingWindow.Model is LayoutDocumentFloatingWindow;

            _areas = new List&lt;IDropArea&gt;();

            if (!isDraggingDocuments)
            {
                _areas.Add(new DropArea&lt;DockingManager&gt;(
                    this,
                    DropAreaType.DockingManager));

                foreach (var areaHost in this.FindVisualChildren&lt;LayoutAnchorablePaneControl&gt;())
                {
                    if (areaHost.Model.Descendents().Any())
                    {
                        _areas.Add(new DropArea&lt;LayoutAnchorablePaneControl&gt;(
                            areaHost,
                            DropAreaType.AnchorablePane));
                    }
                }
            }

            foreach (var areaHost in this.FindVisualChildren&lt;LayoutDocumentPaneControl&gt;())
            {
                _areas.Add(new DropArea&lt;LayoutDocumentPaneControl&gt;(
                    areaHost,
                    DropAreaType.DocumentPane));
            }

            foreach (var areaHost in this.FindVisualChildren&lt;LayoutDocumentPaneGroupControl&gt;())
            {
                var documentGroupModel = areaHost.Model as LayoutDocumentPaneGroup;
                if (documentGroupModel.Children.Where(c =&gt; c.IsVisible).Count() == 0)
                {
                    _areas.Add(new DropArea&lt;LayoutDocumentPaneGroupControl&gt;(
                        areaHost,
                        DropAreaType.DocumentPaneGroup));
                }
            }

            return _areas;
        }

        protected override Size ArrangeOverride(Size arrangeBounds)
        {
            _areas = null;
            return base.ArrangeOverride(arrangeBounds);
        }

        #endregion

        #region LayoutDocument &amp; LayoutAnchorable Templates

        #region LayoutItemTemplate

        /// &lt;summary&gt;
        /// LayoutItemTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutItemTemplateProperty =
            DependencyProperty.Register(&quot;LayoutItemTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null,
                    new PropertyChangedCallback(OnLayoutItemTemplateChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorableTemplate property.  This dependency property 
        /// indicates the template to use to render anchorable and document contents.
        /// &lt;/summary&gt;
        public DataTemplate LayoutItemTemplate
        {
            get { return (DataTemplate)GetValue(LayoutItemTemplateProperty); }
            set { SetValue(LayoutItemTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorableTemplate property.
        /// &lt;/summary&gt;
        private static void OnLayoutItemTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLayoutItemTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorableTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnLayoutItemTemplateChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        #endregion

        #region LayoutItemTemplateSelector

        /// &lt;summary&gt;
        /// LayoutItemTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutItemTemplateSelectorProperty =
            DependencyProperty.Register(&quot;LayoutItemTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null,
                    new PropertyChangedCallback(OnLayoutItemTemplateSelectorChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the LayoutItemTemplateSelector property.  This dependency property 
        /// indicates selector object to use for anchorable templates.
        /// &lt;/summary&gt;
        public DataTemplateSelector LayoutItemTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(LayoutItemTemplateSelectorProperty); }
            set { SetValue(LayoutItemTemplateSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the LayoutItemTemplateSelector property.
        /// &lt;/summary&gt;
        private static void OnLayoutItemTemplateSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLayoutItemTemplateSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the LayoutItemTemplateSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnLayoutItemTemplateSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
        }

        #endregion


        #endregion

        #region DocumentsSource

        /// &lt;summary&gt;
        /// DocumentsSource Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentsSourceProperty =
            DependencyProperty.Register(&quot;DocumentsSource&quot;, typeof(IEnumerable), typeof(DockingManager),
                new FrameworkPropertyMetadata((IEnumerable)null,
                    new PropertyChangedCallback(OnDocumentsSourceChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentsSource property.  This dependency property 
        /// indicates the source collection of documents.
        /// &lt;/summary&gt;
        public IEnumerable DocumentsSource
        {
            get { return (IEnumerable)GetValue(DocumentsSourceProperty); }
            set { SetValue(DocumentsSourceProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentsSource property.
        /// &lt;/summary&gt;
        private static void OnDocumentsSourceChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentsSourceChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentsSource property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentsSourceChanged(DependencyPropertyChangedEventArgs e)
        {
            DetachDocumentsSource(Layout, e.OldValue as IEnumerable);
            AttachDocumentsSource(Layout, e.NewValue as IEnumerable);
        }


        void AttachDocumentsSource(LayoutRoot layout, IEnumerable documentsSource)
        {
            if (documentsSource == null)
                return;

            if (layout == null)
                return;

            //if (layout.Descendents().OfType&lt;LayoutDocument&gt;().Any())
            //    throw new InvalidOperationException(&quot;Unable to set the DocumentsSource property if LayoutDocument objects are already present in the model&quot;);
            var documentsImported = layout.Descendents().OfType&lt;LayoutDocument&gt;().Select(d =&gt; d.Content).ToArray();
            var documents = documentsSource as IEnumerable;
            var listOfDocumentsToImport = new List&lt;object&gt;(documents.OfType&lt;object&gt;());

            foreach (var document in listOfDocumentsToImport.ToArray())
            {
                if (documentsImported.Contains(document))
                    listOfDocumentsToImport.Remove(document);
            }


            LayoutDocumentPane documentPane = null;
            if (layout.LastFocusedDocument != null)
            {
                documentPane = layout.LastFocusedDocument.Parent as LayoutDocumentPane;
            }

            if (documentPane == null)
            {
                documentPane = layout.Descendents().OfType&lt;LayoutDocumentPane&gt;().FirstOrDefault();
            }

            //if (documentPane == null)
            //    throw new InvalidOperationException(&quot;Layout must contains at least one LayoutDocumentPane in order to host documents&quot;);

            _suspendLayoutItemCreation = true;
            foreach (var documentContentToImport in listOfDocumentsToImport)
            {

                //documentPane.Children.Add(new LayoutDocument() { Content = documentToImport });

                var documentToImport = new LayoutDocument()
                {
                    Content = documentContentToImport
                };

                bool added = false;
                if (LayoutUpdateStrategy != null)
                {
                    added = LayoutUpdateStrategy.BeforeInsertDocument(layout, documentToImport, documentPane);
                }

                if (!added)
                {
                    if (documentPane == null)
                        throw new InvalidOperationException(&quot;Layout must contains at least one LayoutDocumentPane in order to host documents&quot;);

                    documentPane.Children.Add(documentToImport);
                    added = true;
                }

                if (LayoutUpdateStrategy != null)
                    LayoutUpdateStrategy.AfterInsertDocument(layout, documentToImport);


                CreateDocumentLayoutItem(documentToImport);

            }
            _suspendLayoutItemCreation = true;


            var documentsSourceAsNotifier = documentsSource as INotifyCollectionChanged;
            if (documentsSourceAsNotifier != null)
                documentsSourceAsNotifier.CollectionChanged += new NotifyCollectionChangedEventHandler(documentsSourceElementsChanged);
        }

        internal bool SuspendDocumentsSourceBinding = false;

        void documentsSourceElementsChanged(object sender, NotifyCollectionChangedEventArgs e)
        {
            if (Layout == null)
                return;

            //When deserializing documents are created automatically by the deserializer
            if (SuspendDocumentsSourceBinding)
                return;

            //handle remove
            if (e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Remove ||
                e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Replace)
            {
                if (e.OldItems != null)
                {
                    var documentsToRemove = Layout.Descendents().OfType&lt;LayoutDocument&gt;().Where(d =&gt; e.OldItems.Contains(d.Content)).ToArray();
                    foreach (var documentToRemove in documentsToRemove)
                    {
                        (documentToRemove.Parent as ILayoutContainer).RemoveChild(
                            documentToRemove);
                    }
                }
            }

            //handle add
            if (e.NewItems != null &amp;&amp;
                (e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Add ||
                e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Replace))
            {
                if (e.NewItems != null)
                {
                    LayoutDocumentPane documentPane = null;
                    if (Layout.LastFocusedDocument != null)
                    {
                        documentPane = Layout.LastFocusedDocument.Parent as LayoutDocumentPane;
                    }

                    if (documentPane == null)
                    {
                        documentPane = Layout.Descendents().OfType&lt;LayoutDocumentPane&gt;().FirstOrDefault();
                    }

                    //if (documentPane == null)
                    //    throw new InvalidOperationException(&quot;Layout must contains at least one LayoutDocumentPane in order to host documents&quot;);

                    _suspendLayoutItemCreation = true;

                    foreach (var documentContentToImport in e.NewItems)
                    {
                        var documentToImport = new LayoutDocument()
                        {
                            Content = documentContentToImport
                        };

                        bool added = false;
                        if (LayoutUpdateStrategy != null)
                        {
                            added = LayoutUpdateStrategy.BeforeInsertDocument(Layout, documentToImport, documentPane);
                        }

                        if (!added)
                        {
                            if (documentPane == null)
                                throw new InvalidOperationException(&quot;Layout must contains at least one LayoutDocumentPane in order to host documents&quot;);

                            documentPane.Children.Add(documentToImport);
                            added = true;
                        }

                        if (LayoutUpdateStrategy != null)
                        {
                            LayoutUpdateStrategy.AfterInsertDocument(Layout, documentToImport);
                        }


                        var root = documentToImport.Root;

                        if (root != null &amp;&amp; root.Manager == this)
                        {
                            CreateDocumentLayoutItem(documentToImport);
                        }
                    }
                    _suspendLayoutItemCreation = false;
                }
            }

            if (e.Action == NotifyCollectionChangedAction.Reset)
            {
                //NOTE: I&#39;m going to clear every document present in layout but
                //some documents may have been added directly to the layout, for now I clear them too
                var documentsToRemove = Layout.Descendents().OfType&lt;LayoutDocument&gt;().ToArray();
                foreach (var documentToRemove in documentsToRemove)
                {
                    (documentToRemove.Parent as ILayoutContainer).RemoveChild(
                        documentToRemove);
                }
            }

            if (Layout != null)
            {
                Layout.CollectGarbage();
            }
        }

        void DetachDocumentsSource(LayoutRoot layout, IEnumerable documentsSource)
        {
            if (documentsSource == null)
                return;

            if (layout == null)
                return;

            var documentsToRemove = layout.Descendents().OfType&lt;LayoutDocument&gt;()
                .Where(d =&gt; documentsSource.Contains(d.Content)).ToArray();

            foreach (var documentToRemove in documentsToRemove)
            {
                (documentToRemove.Parent as ILayoutContainer).RemoveChild(
                    documentToRemove);
            }

            var documentsSourceAsNotifier = documentsSource as INotifyCollectionChanged;
            if (documentsSourceAsNotifier != null)
                documentsSourceAsNotifier.CollectionChanged -= new NotifyCollectionChangedEventHandler(documentsSourceElementsChanged);
        }


        #endregion

        #region DocumentCloseCommand

        internal void _ExecuteCloseCommand(LayoutDocument document)
        {
            if (DocumentClosing != null)
            {
                var evargs = new DocumentClosingEventArgs(document);
                DocumentClosing(this, evargs);
                if (evargs.Cancel)
                    return;
            }

            if (!document.TestCanClose())
                return;

            document.Close();

            if (DocumentClosed != null)
            { 
                var evargs = new DocumentClosedEventArgs(document);
                DocumentClosed(this, evargs);
            }
        }

        /// &lt;summary&gt;
        /// Event fired when a document is about to be closed
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;Subscribers have the opportuniy to cancel the operation.&lt;/remarks&gt;
        public event EventHandler&lt;DocumentClosingEventArgs&gt; DocumentClosing;

        /// &lt;summary&gt;
        /// Event fired after a document is closed
        /// &lt;/summary&gt;
        public event EventHandler&lt;DocumentClosedEventArgs&gt; DocumentClosed;



        #endregion

        internal void _ExecuteCloseAllButThisCommand(LayoutContent contentSelected)
        {
            foreach (var contentToClose in Layout.Descendents().OfType&lt;LayoutContent&gt;().Where(d =&gt; d != contentSelected &amp;&amp; (d.Parent is LayoutDocumentPane || d.Parent is LayoutDocumentFloatingWindow)).ToArray())
            {
                if (!contentToClose.CanClose)
                    continue;

                var layoutItem = GetLayoutItemFromModel(contentToClose);
                if (layoutItem.CloseCommand != null)
                {
                    if (layoutItem.CloseCommand.CanExecute(null))
                        layoutItem.CloseCommand.Execute(null);
                }
                else
                {
                    if (contentToClose is LayoutDocument)
                        _ExecuteCloseCommand(contentToClose as LayoutDocument);
                    else if (contentToClose is LayoutAnchorable)
                        _ExecuteCloseCommand(contentToClose as LayoutAnchorable);
                }
            }
        }

        #region DocumentContextMenu

        /// &lt;summary&gt;
        /// DocumentContextMenu Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentContextMenuProperty =
            DependencyProperty.Register(&quot;DocumentContextMenu&quot;, typeof(ContextMenu), typeof(DockingManager),
                new FrameworkPropertyMetadata((ContextMenu)null));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentContextMenu property.  This dependency property 
        /// indicates context menu to show for documents.
        /// &lt;/summary&gt;
        public ContextMenu DocumentContextMenu
        {
            get { return (ContextMenu)GetValue(DocumentContextMenuProperty); }
            set { SetValue(DocumentContextMenuProperty, value); }
        }

        #endregion

        #region AnchorablesSource

        /// &lt;summary&gt;
        /// AnchorablesSource Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorablesSourceProperty =
            DependencyProperty.Register(&quot;AnchorablesSource&quot;, typeof(IEnumerable), typeof(DockingManager),
                new FrameworkPropertyMetadata((IEnumerable)null,
                    new PropertyChangedCallback(OnAnchorablesSourceChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorablesSource property.  This dependency property 
        /// indicates source collection of anchorables.
        /// &lt;/summary&gt;
        public IEnumerable AnchorablesSource
        {
            get { return (IEnumerable)GetValue(AnchorablesSourceProperty); }
            set { SetValue(AnchorablesSourceProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the AnchorablesSource property.
        /// &lt;/summary&gt;
        private static void OnAnchorablesSourceChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnAnchorablesSourceChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the AnchorablesSource property.
        /// &lt;/summary&gt;
        protected virtual void OnAnchorablesSourceChanged(DependencyPropertyChangedEventArgs e)
        {
            DetachAnchorablesSource(Layout, e.OldValue as IEnumerable);
            AttachAnchorablesSource(Layout, e.NewValue as IEnumerable);
        }

        void AttachAnchorablesSource(LayoutRoot layout, IEnumerable anchorablesSource)
        {
            if (anchorablesSource == null)
                return;

            if (layout == null)
                return;

            //if (layout.Descendents().OfType&lt;LayoutAnchorable&gt;().Any())
            //    throw new InvalidOperationException(&quot;Unable to set the AnchorablesSource property if LayoutAnchorable objects are already present in the model&quot;);
            var anchorablesImported = layout.Descendents().OfType&lt;LayoutAnchorable&gt;().Select(d =&gt; d.Content).ToArray();
            var anchorables = anchorablesSource as IEnumerable;
            var listOfAnchorablesToImport = new List&lt;object&gt;(anchorables.OfType&lt;object&gt;());

            foreach (var document in listOfAnchorablesToImport.ToArray())
            {
                if (anchorablesImported.Contains(document))
                    listOfAnchorablesToImport.Remove(document);
            }

            LayoutAnchorablePane anchorablePane = null;
            if (layout.ActiveContent != null)
            {
                //look for active content parent pane
                anchorablePane = layout.ActiveContent.Parent as LayoutAnchorablePane;
            }

            if (anchorablePane == null)
            {
                //look for a pane on the right side
                anchorablePane = layout.Descendents().OfType&lt;LayoutAnchorablePane&gt;().Where(pane =&gt; !pane.IsHostedInFloatingWindow &amp;&amp; pane.GetSide() == AnchorSide.Right).FirstOrDefault();
            }

            if (anchorablePane == null)
            {
                //look for an available pane
                anchorablePane = layout.Descendents().OfType&lt;LayoutAnchorablePane&gt;().FirstOrDefault();
            }

            _suspendLayoutItemCreation = true;
            foreach (var anchorableContentToImport in listOfAnchorablesToImport)
            {
                var anchorableToImport = new LayoutAnchorable()
                {
                    Content = anchorableContentToImport
                };

                bool added = false;
                if (LayoutUpdateStrategy != null)
                {
                    added = LayoutUpdateStrategy.BeforeInsertAnchorable(layout, anchorableToImport, anchorablePane);
                }

                if (!added)
                {
                    if (anchorablePane == null)
                    {
                        var mainLayoutPanel = new LayoutPanel() { Orientation = Orientation.Horizontal };
                        if (layout.RootPanel != null)
                        {
                            mainLayoutPanel.Children.Add(layout.RootPanel);
                        }

                        layout.RootPanel = mainLayoutPanel;
                        anchorablePane = new LayoutAnchorablePane() { DockWidth = new GridLength(200.0, GridUnitType.Pixel) };
                        mainLayoutPanel.Children.Add(anchorablePane);
                    }

                    anchorablePane.Children.Add(anchorableToImport);
                    added = true;
                }

                if (LayoutUpdateStrategy != null)
                    LayoutUpdateStrategy.AfterInsertAnchorable(layout, anchorableToImport);


                CreateAnchorableLayoutItem(anchorableToImport);

            }

            _suspendLayoutItemCreation = false;

            var anchorablesSourceAsNotifier = anchorablesSource as INotifyCollectionChanged;
            if (anchorablesSourceAsNotifier != null)
                anchorablesSourceAsNotifier.CollectionChanged += new NotifyCollectionChangedEventHandler(anchorablesSourceElementsChanged);
        }

        internal bool SuspendAnchorablesSourceBinding = false;

        void anchorablesSourceElementsChanged(object sender, NotifyCollectionChangedEventArgs e)
        {
            if (Layout == null)
                return;

            //When deserializing documents are created automatically by the deserializer
            if (SuspendAnchorablesSourceBinding)
                return;

            //handle remove
            if (e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Remove ||
                e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Replace)
            {
                if (e.OldItems != null)
                {
                    var anchorablesToRemove = Layout.Descendents().OfType&lt;LayoutAnchorable&gt;().Where(d =&gt; e.OldItems.Contains(d.Content)).ToArray();
                    foreach (var anchorableToRemove in anchorablesToRemove)
                    {
                        (anchorableToRemove.Parent as ILayoutContainer).RemoveChild(
                            anchorableToRemove);
                    }
                }
            }

            //handle add
            if (e.NewItems != null &amp;&amp;
                (e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Add ||
                e.Action == System.Collections.Specialized.NotifyCollectionChangedAction.Replace))
            {
                if (e.NewItems != null)
                {
                    LayoutAnchorablePane anchorablePane = null;

                    if (Layout.ActiveContent != null)
                    {
                        //look for active content parent pane
                        anchorablePane = Layout.ActiveContent.Parent as LayoutAnchorablePane;
                    }

                    if (anchorablePane == null)
                    {
                        //look for a pane on the right side
                        anchorablePane = Layout.Descendents().OfType&lt;LayoutAnchorablePane&gt;().Where(pane =&gt; !pane.IsHostedInFloatingWindow &amp;&amp; pane.GetSide() == AnchorSide.Right).FirstOrDefault();
                    }

                    if (anchorablePane == null)
                    {
                        //look for an available pane
                        anchorablePane = Layout.Descendents().OfType&lt;LayoutAnchorablePane&gt;().FirstOrDefault();
                    }

                    _suspendLayoutItemCreation = true;
                    foreach (var anchorableContentToImport in e.NewItems)
                    {
                        var anchorableToImport = new LayoutAnchorable()
                        {
                            Content = anchorableContentToImport
                        };

                        bool added = false;
                        if (LayoutUpdateStrategy != null)
                        {
                            added = LayoutUpdateStrategy.BeforeInsertAnchorable(Layout, anchorableToImport, anchorablePane);
                        }

                        if (!added)
                        {
                            if (anchorablePane == null)
                            {
                                var mainLayoutPanel = new LayoutPanel() { Orientation = Orientation.Horizontal };
                                if (Layout.RootPanel != null)
                                {
                                    mainLayoutPanel.Children.Add(Layout.RootPanel);
                                }

                                Layout.RootPanel = mainLayoutPanel;
                                anchorablePane = new LayoutAnchorablePane() { DockWidth = new GridLength(200.0, GridUnitType.Pixel) };
                                mainLayoutPanel.Children.Add(anchorablePane);
                            }

                            anchorablePane.Children.Add(anchorableToImport);
                            added = true;
                        }

                        if (LayoutUpdateStrategy != null)
                        {
                            LayoutUpdateStrategy.AfterInsertAnchorable(Layout, anchorableToImport);
                        }

                        var root = anchorableToImport.Root;

                        if (root != null &amp;&amp; root.Manager == this)
                        {
                            CreateAnchorableLayoutItem(anchorableToImport);
                        }

                    }
                    _suspendLayoutItemCreation = false;
                }
            }

            if (e.Action == NotifyCollectionChangedAction.Reset)
            {
                //NOTE: I&#39;m going to clear every anchorable present in layout but
                //some anchorable may have been added directly to the layout, for now I clear them too
                var anchorablesToRemove = Layout.Descendents().OfType&lt;LayoutAnchorable&gt;().ToArray();
                foreach (var anchorableToRemove in anchorablesToRemove)
                {
                    (anchorableToRemove.Parent as ILayoutContainer).RemoveChild(
                        anchorableToRemove);
                }
            }

            if (Layout != null)
                Layout.CollectGarbage();
        }

        void DetachAnchorablesSource(LayoutRoot layout, IEnumerable anchorablesSource)
        {
            if (anchorablesSource == null)
                return;

            if (layout == null)
                return;

            var anchorablesToRemove = layout.Descendents().OfType&lt;LayoutAnchorable&gt;()
                .Where(d =&gt; anchorablesSource.Contains(d.Content)).ToArray();

            foreach (var anchorableToRemove in anchorablesToRemove)
            {
                (anchorableToRemove.Parent as ILayoutContainer).RemoveChild(
                    anchorableToRemove);
            }

            var anchorablesSourceAsNotifier = anchorablesSource as INotifyCollectionChanged;
            if (anchorablesSourceAsNotifier != null)
                anchorablesSourceAsNotifier.CollectionChanged -= new NotifyCollectionChangedEventHandler(anchorablesSourceElementsChanged);
        }

        #endregion

        internal void _ExecuteCloseCommand(LayoutAnchorable anchorable)
        {
            var model = anchorable as LayoutAnchorable;
            if (model != null &amp;&amp; model.TestCanClose())
            {
                if (model.IsAutoHidden)
                    model.ToggleAutoHide();

                model.Close();
                return;
            }
        }

        internal void _ExecuteHideCommand(LayoutAnchorable anchorable)
        {
            var model = anchorable as LayoutAnchorable;
            if (model != null)
            {
                //by default hide the anchorable
                model.Hide();
            }
        }

        internal void _ExecuteAutoHideCommand(LayoutAnchorable _anchorable)
        {
            _anchorable.ToggleAutoHide();
        }

        internal void _ExecuteFloatCommand(LayoutContent contentToFloat)
        {
            contentToFloat.Float();
        }

        internal void _ExecuteDockCommand(LayoutAnchorable anchorable)
        {
            anchorable.Dock();
        }

        internal void _ExecuteDockAsDocumentCommand(LayoutContent content)
        {
            content.DockAsDocument();
        }

        #region ActiveContent

        /// &lt;summary&gt;
        /// ActiveContent Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty ActiveContentProperty =
            DependencyProperty.Register(&quot;ActiveContent&quot;, typeof(object), typeof(DockingManager),
                new FrameworkPropertyMetadata((object)null,
                    new PropertyChangedCallback(OnActiveContentChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the ActiveContent property.  This dependency property 
        /// indicates the content currently active.
        /// &lt;/summary&gt;
        public object ActiveContent
        {
            get { return (object)GetValue(ActiveContentProperty); }
            set { SetValue(ActiveContentProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the ActiveContent property.
        /// &lt;/summary&gt;
        private static void OnActiveContentChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).InternalSetActiveContent(e.NewValue);
            ((DockingManager)d).OnActiveContentChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the ActiveContent property.
        /// &lt;/summary&gt;
        protected virtual void OnActiveContentChanged(DependencyPropertyChangedEventArgs e)
        {
            if (ActiveContentChanged != null)
                ActiveContentChanged(this, EventArgs.Empty);
        }


        bool _insideInternalSetActiveContent = false;
        void InternalSetActiveContent(object contentObject)
        {
            var layoutContent = Layout.Descendents().OfType&lt;LayoutContent&gt;().FirstOrDefault(lc =&gt; lc == contentObject || lc.Content == contentObject);
            _insideInternalSetActiveContent = true;
            Layout.ActiveContent = layoutContent;
            _insideInternalSetActiveContent = false;
        }

        public event EventHandler ActiveContentChanged;

        #endregion

        #region AnchorableContextMenu

        /// &lt;summary&gt;
        /// AnchorableContextMenu Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AnchorableContextMenuProperty =
            DependencyProperty.Register(&quot;AnchorableContextMenu&quot;, typeof(ContextMenu), typeof(DockingManager),
                new FrameworkPropertyMetadata((ContextMenu)null));

        /// &lt;summary&gt;
        /// Gets or sets the AnchorableContextMenu property.  This dependency property 
        /// indicates the context menu to show up for anchorables.
        /// &lt;/summary&gt;
        public ContextMenu AnchorableContextMenu
        {
            get { return (ContextMenu)GetValue(AnchorableContextMenuProperty); }
            set { SetValue(AnchorableContextMenuProperty, value); }
        }

        #endregion

        #region Theme

        /// &lt;summary&gt;
        /// Theme Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty ThemeProperty =
            DependencyProperty.Register(&quot;Theme&quot;, typeof(Theme), typeof(DockingManager),
                new FrameworkPropertyMetadata(null,
                    new PropertyChangedCallback(OnThemeChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the Theme property.  This dependency property 
        /// indicates the theme to use for AvalonDock controls.
        /// &lt;/summary&gt;
        public Theme Theme
        {
            get { return (Theme)GetValue(ThemeProperty); }
            set { SetValue(ThemeProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the Theme property.
        /// &lt;/summary&gt;
        private static void OnThemeChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnThemeChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the Theme property.
        /// &lt;/summary&gt;
        protected virtual void OnThemeChanged(DependencyPropertyChangedEventArgs e)
        {
            var oldTheme = e.OldValue as Theme;
            var newTheme = e.NewValue as Theme;
            var resources = this.Resources;
            if (oldTheme != null)
            {
                var resourceDictionaryToRemove =
                    resources.MergedDictionaries.FirstOrDefault(r =&gt; r.Source == oldTheme.GetResourceUri());
                if (resourceDictionaryToRemove != null)
                    resources.MergedDictionaries.Remove(
                        resourceDictionaryToRemove);
            }

            if (newTheme != null)
            {
                resources.MergedDictionaries.Add(new ResourceDictionary() { Source = newTheme.GetResourceUri() });
            }

            foreach (var fwc in _fwList)
                fwc.UpdateThemeResources(oldTheme);

            if (_navigatorWindow != null)
                _navigatorWindow.UpdateThemeResources();

            if (_overlayWindow != null)
                _overlayWindow.UpdateThemeResources();
        }

        #endregion

        #region GridSplitterWidth

        /// &lt;summary&gt;
        /// GridSplitterWidth Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty GridSplitterWidthProperty =
            DependencyProperty.Register(&quot;GridSplitterWidth&quot;, typeof(double), typeof(DockingManager),
                new FrameworkPropertyMetadata((double)6.0));

        /// &lt;summary&gt;
        /// Gets or sets the GridSplitterWidth property.  This dependency property 
        /// indicates width of grid splitters.
        /// &lt;/summary&gt;
        public double GridSplitterWidth
        {
            get { return (double)GetValue(GridSplitterWidthProperty); }
            set { SetValue(GridSplitterWidthProperty, value); }
        }

        #endregion

        #region GridSplitterHeight

        /// &lt;summary&gt;
        /// GridSplitterHeight Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty GridSplitterHeightProperty =
            DependencyProperty.Register(&quot;GridSplitterHeight&quot;, typeof(double), typeof(DockingManager),
                new FrameworkPropertyMetadata((double)6.0));

        /// &lt;summary&gt;
        /// Gets or sets the GridSplitterHeight property.  This dependency property 
        /// indicates height of grid splitters.
        /// &lt;/summary&gt;
        public double GridSplitterHeight
        {
            get { return (double)GetValue(GridSplitterHeightProperty); }
            set { SetValue(GridSplitterHeightProperty, value); }
        }

        #endregion

        internal void _ExecuteContentActivateCommand(LayoutContent content)
        {
            content.IsActive = true;
        }

        #region DocumentPaneMenuItemHeaderTemplate

        /// &lt;summary&gt;
        /// DocumentPaneMenuItemHeaderTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentPaneMenuItemHeaderTemplateProperty =
            DependencyProperty.Register(&quot;DocumentPaneMenuItemHeaderTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null,
                    new PropertyChangedCallback(OnDocumentPaneMenuItemHeaderTemplateChanged),
                    new CoerceValueCallback(CoerceDocumentPaneMenuItemHeaderTemplateValue)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentPaneMenuItemHeaderTemplate property.  This dependency property 
        /// indicates the header template to use while creating menu items for the document panes.
        /// &lt;/summary&gt;
        public DataTemplate DocumentPaneMenuItemHeaderTemplate
        {
            get { return (DataTemplate)GetValue(DocumentPaneMenuItemHeaderTemplateProperty); }
            set { SetValue(DocumentPaneMenuItemHeaderTemplateProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentPaneMenuItemHeaderTemplate property.
        /// &lt;/summary&gt;
        private static void OnDocumentPaneMenuItemHeaderTemplateChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentPaneMenuItemHeaderTemplateChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentPaneMenuItemHeaderTemplate property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentPaneMenuItemHeaderTemplateChanged(DependencyPropertyChangedEventArgs e)
        { 
        }

        /// &lt;summary&gt;
        /// Coerces the DocumentPaneMenuItemHeaderTemplate value.
        /// &lt;/summary&gt;
        private static object CoerceDocumentPaneMenuItemHeaderTemplateValue(DependencyObject d, object value)
        {
            if (value != null &amp;&amp;
                d.GetValue(DocumentPaneMenuItemHeaderTemplateSelectorProperty) != null)
                return null;
            if (value == null)
                return d.GetValue(DocumentHeaderTemplateProperty);

            return value;
        }

        #endregion

        #region DocumentPaneMenuItemHeaderTemplateSelector

        /// &lt;summary&gt;
        /// DocumentPaneMenuItemHeaderTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty DocumentPaneMenuItemHeaderTemplateSelectorProperty =
            DependencyProperty.Register(&quot;DocumentPaneMenuItemHeaderTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null,
                    new PropertyChangedCallback(OnDocumentPaneMenuItemHeaderTemplateSelectorChanged),
                    new CoerceValueCallback(CoerceDocumentPaneMenuItemHeaderTemplateSelectorValue)));

        /// &lt;summary&gt;
        /// Gets or sets the DocumentPaneMenuItemHeaderTemplateSelector property.  This dependency property 
        /// indicates the data template selector to use for the menu items show when user select the DocumentPane document switch context menu.
        /// &lt;/summary&gt;
        public DataTemplateSelector DocumentPaneMenuItemHeaderTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(DocumentPaneMenuItemHeaderTemplateSelectorProperty); }
            set { SetValue(DocumentPaneMenuItemHeaderTemplateSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the DocumentPaneMenuItemHeaderTemplateSelector property.
        /// &lt;/summary&gt;
        private static void OnDocumentPaneMenuItemHeaderTemplateSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnDocumentPaneMenuItemHeaderTemplateSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the DocumentPaneMenuItemHeaderTemplateSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnDocumentPaneMenuItemHeaderTemplateSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
            if (e.NewValue != null &amp;&amp;
                DocumentPaneMenuItemHeaderTemplate != null)
                DocumentPaneMenuItemHeaderTemplate = null;

        }

        /// &lt;summary&gt;
        /// Coerces the DocumentPaneMenuItemHeaderTemplateSelector value.
        /// &lt;/summary&gt;
        private static object CoerceDocumentPaneMenuItemHeaderTemplateSelectorValue(DependencyObject d, object value)
        {
            return value;
        }

        #endregion

        #region IconContentTemplate

        /// &lt;summary&gt;
        /// IconContentTemplate Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty IconContentTemplateProperty =
            DependencyProperty.Register(&quot;IconContentTemplate&quot;, typeof(DataTemplate), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplate)null));

        /// &lt;summary&gt;
        /// Gets or sets the IconContentTemplate property.  This dependency property 
        /// indicates the data template to use while extracting the icon from model.
        /// &lt;/summary&gt;
        public DataTemplate IconContentTemplate
        {
            get { return (DataTemplate)GetValue(IconContentTemplateProperty); }
            set { SetValue(IconContentTemplateProperty, value); }
        }

        #endregion

        #region IconContentTemplateSelector

        /// &lt;summary&gt;
        /// IconContentTemplateSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty IconContentTemplateSelectorProperty =
            DependencyProperty.Register(&quot;IconContentTemplateSelector&quot;, typeof(DataTemplateSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((DataTemplateSelector)null));

        /// &lt;summary&gt;
        /// Gets or sets the IconContentTemplateSelector property.  This dependency property 
        /// indicates data template selector to use while selecting the datatamplate for content icons.
        /// &lt;/summary&gt;
        public DataTemplateSelector IconContentTemplateSelector
        {
            get { return (DataTemplateSelector)GetValue(IconContentTemplateSelectorProperty); }
            set { SetValue(IconContentTemplateSelectorProperty, value); }
        }

        #endregion

        #region LayoutItems

        List&lt;LayoutItem&gt; _layoutItems = new List&lt;LayoutItem&gt;();

		public List&lt;LayoutItem&gt; LayoutItems { get { return _layoutItems; } }

        bool _suspendLayoutItemCreation = false;

        void DetachLayoutItems()
        {
            if (Layout != null)
            {
                _layoutItems.ForEach&lt;LayoutItem&gt;(i =&gt; i.Detach());
                _layoutItems.Clear();
                Layout.ElementAdded -= new EventHandler&lt;LayoutElementEventArgs&gt;(Layout_ElementAdded);
                Layout.ElementRemoved -= new EventHandler&lt;LayoutElementEventArgs&gt;(Layout_ElementRemoved);
            }
        }

        void Layout_ElementRemoved(object sender, LayoutElementEventArgs e)
        {
            if (_suspendLayoutItemCreation)
                return;

            CollectLayoutItemsDeleted();
        }

        void Layout_ElementAdded(object sender, LayoutElementEventArgs e)
        {
            if (_suspendLayoutItemCreation)
                return;

            foreach (var content in Layout.Descendents().OfType&lt;LayoutContent&gt;())
            {
                if (content is LayoutDocument)
                    CreateDocumentLayoutItem(content as LayoutDocument);
                else //if (content is LayoutAnchorable)
                    CreateAnchorableLayoutItem(content as LayoutAnchorable);
            }

            CollectLayoutItemsDeleted();
        }


        DispatcherOperation _collectLayoutItemsOperations = null;
        void CollectLayoutItemsDeleted()
        {
            if (_collectLayoutItemsOperations != null)
                return;
            _collectLayoutItemsOperations = Dispatcher.BeginInvoke(new Action(() =&gt;
                {
                    _collectLayoutItemsOperations = null;
                    foreach (var itemToRemove in _layoutItems.Where(item =&gt; item.LayoutElement.Root != Layout).ToArray())
                    {

                        if (itemToRemove != null &amp;&amp;
                            itemToRemove.Model != null &amp;&amp;
                            itemToRemove.Model is UIElement)
                        {
                            //((ILogicalChildrenContainer)this).InternalRemoveLogicalChild(itemToRemove.Model as UIElement);
                        }

                        itemToRemove.Detach();
                        _layoutItems.Remove(itemToRemove);

                    }
                }));
        }


        void AttachLayoutItems()
        {
            if (Layout != null)
            {
                foreach (var document in Layout.Descendents().OfType&lt;LayoutDocument&gt;().ToArray())
                {
                    CreateDocumentLayoutItem(document);
                    //var documentItem = new LayoutDocumentItem();
                    //documentItem.Attach(document);
                    //ApplyStyleToLayoutItem(documentItem);
                    //_layoutItems.Add(documentItem);
                }
                foreach (var anchorable in Layout.Descendents().OfType&lt;LayoutAnchorable&gt;().ToArray())
                {
                    CreateAnchorableLayoutItem(anchorable);
                    //var anchorableItem = new LayoutAnchorableItem();
                    //anchorableItem.Attach(anchorable);
                    //ApplyStyleToLayoutItem(anchorableItem);
                    //_layoutItems.Add(anchorableItem);
                }

                Layout.ElementAdded += new EventHandler&lt;LayoutElementEventArgs&gt;(Layout_ElementAdded);
                Layout.ElementRemoved += new EventHandler&lt;LayoutElementEventArgs&gt;(Layout_ElementRemoved);
            }
        }

        void ApplyStyleToLayoutItem(LayoutItem layoutItem)
        {
            layoutItem._ClearDefaultBindings();
            if (LayoutItemContainerStyle != null)
                layoutItem.Style = LayoutItemContainerStyle;
            else if (LayoutItemContainerStyleSelector != null)
                layoutItem.Style = LayoutItemContainerStyleSelector.SelectStyle(layoutItem.Model, layoutItem);
            layoutItem._SetDefaultBindings();
        }

        void CreateAnchorableLayoutItem(LayoutAnchorable contentToAttach)
        {
            if (_layoutItems.Any(item =&gt; item.LayoutElement == contentToAttach))
                return;

            var layoutItem = new LayoutAnchorableItem();
            layoutItem.Attach(contentToAttach);
            ApplyStyleToLayoutItem(layoutItem);
            _layoutItems.Add(layoutItem);

            if (contentToAttach != null &amp;&amp;
                contentToAttach.Content != null &amp;&amp;
                contentToAttach.Content is UIElement)
            {
                InternalAddLogicalChild(contentToAttach.Content);
            }

        }

        void CreateDocumentLayoutItem(LayoutDocument contentToAttach)
        {
            if (_layoutItems.Any(item =&gt; item.LayoutElement == contentToAttach))
                return;

            var layoutItem = new LayoutDocumentItem();
            layoutItem.Attach(contentToAttach);
            ApplyStyleToLayoutItem(layoutItem);
            _layoutItems.Add(layoutItem);

            if (contentToAttach != null &amp;&amp;
                contentToAttach.Content != null &amp;&amp;
                contentToAttach.Content is UIElement)
            {
                InternalAddLogicalChild(contentToAttach.Content);
            }

        }

        #region LayoutItemContainerStyle

        /// &lt;summary&gt;
        /// LayoutItemContainerStyle Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutItemContainerStyleProperty =
            DependencyProperty.Register(&quot;LayoutItemContainerStyle&quot;, typeof(Style), typeof(DockingManager),
                new FrameworkPropertyMetadata((Style)null,
                    new PropertyChangedCallback(OnLayoutItemContainerStyleChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the LayoutItemContainerStyle property.  This dependency property 
        /// indicates the style to apply to LayoutDocumentItem objects. A LayoutDocumentItem object is created when a new LayoutDocument is created inside the current Layout.
        /// &lt;/summary&gt;
        public Style LayoutItemContainerStyle
        {
            get { return (Style)GetValue(LayoutItemContainerStyleProperty); }
            set { SetValue(LayoutItemContainerStyleProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the LayoutItemContainerStyle property.
        /// &lt;/summary&gt;
        private static void OnLayoutItemContainerStyleChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLayoutItemContainerStyleChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the LayoutItemContainerStyle property.
        /// &lt;/summary&gt;
        protected virtual void OnLayoutItemContainerStyleChanged(DependencyPropertyChangedEventArgs e)
        {
            AttachLayoutItems();
        }

        #endregion

        #region LayoutItemContainerStyleSelector

        /// &lt;summary&gt;
        /// LayoutItemContainerStyleSelector Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty LayoutItemContainerStyleSelectorProperty =
            DependencyProperty.Register(&quot;LayoutItemContainerStyleSelector&quot;, typeof(StyleSelector), typeof(DockingManager),
                new FrameworkPropertyMetadata((StyleSelector)null,
                    new PropertyChangedCallback(OnLayoutItemContainerStyleSelectorChanged)));

        /// &lt;summary&gt;
        /// Gets or sets the LayoutItemContainerStyleSelector property.  This dependency property 
        /// indicates style selector of the LayoutDocumentItemStyle.
        /// &lt;/summary&gt;
        public StyleSelector LayoutItemContainerStyleSelector
        {
            get { return (StyleSelector)GetValue(LayoutItemContainerStyleSelectorProperty); }
            set { SetValue(LayoutItemContainerStyleSelectorProperty, value); }
        }

        /// &lt;summary&gt;
        /// Handles changes to the LayoutItemContainerStyleSelector property.
        /// &lt;/summary&gt;
        private static void OnLayoutItemContainerStyleSelectorChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((DockingManager)d).OnLayoutItemContainerStyleSelectorChanged(e);
        }

        /// &lt;summary&gt;
        /// Provides derived classes an opportunity to handle changes to the LayoutItemContainerStyleSelector property.
        /// &lt;/summary&gt;
        protected virtual void OnLayoutItemContainerStyleSelectorChanged(DependencyPropertyChangedEventArgs e)
        {
            AttachLayoutItems();
        }

        #endregion

        /// &lt;summary&gt;
        /// Return the LayoutItem wrapper for the content passed as argument
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;content&quot;&gt;LayoutContent to search&lt;/param&gt;
        /// &lt;returns&gt;Either a LayoutAnchorableItem or LayoutDocumentItem which contains the LayoutContent passed as argument&lt;/returns&gt;
        public LayoutItem GetLayoutItemFromModel(LayoutContent content)
        {
            return _layoutItems.FirstOrDefault(item =&gt; item.LayoutElement == content);
        }
        #endregion

        #region NavigatorWindow
        NavigatorWindow _navigatorWindow = null;

        void ShowNavigatorWindow()
        {
            if (_navigatorWindow == null)
            {
                _navigatorWindow = new NavigatorWindow(this)
                { 
                    Owner = Window.GetWindow(this),
                    WindowStartupLocation = WindowStartupLocation.CenterOwner
                };
            }

            _navigatorWindow.ShowDialog();
            _navigatorWindow = null;

            Trace.WriteLine( &quot;ShowNavigatorWindow()&quot; );
        }

        bool IsNavigatorWindowActive
        {
            get { return _navigatorWindow != null; }
        }


        protected override void OnPreviewKeyDown(KeyEventArgs e)
        {
          Trace.WriteLine( string.Format( &quot;OnPreviewKeyDown({0})&quot;, e.Key ) );
            if (Keyboard.IsKeyDown(Key.LeftCtrl) || Keyboard.IsKeyDown(Key.RightCtrl))
            {
                if (e.IsDown &amp;&amp; e.Key == Key.Tab)
                {
                    if (!IsNavigatorWindowActive)
                    {
                        ShowNavigatorWindow();
                        e.Handled = true;
                    }
                }
            }

            base.OnPreviewKeyDown(e);
        }

        #endregion

        #region ShowSystemMenu

        /// &lt;summary&gt;
        /// ShowSystemMenu Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty ShowSystemMenuProperty =
            DependencyProperty.Register(&quot;ShowSystemMenu&quot;, typeof(bool), typeof(DockingManager),
                new FrameworkPropertyMetadata((bool)true));

        /// &lt;summary&gt;
        /// Gets or sets the ShowSystemMenu property.  This dependency property 
        /// indicates if floating windows should show the system menu when a custom context menu is not defined.
        /// &lt;/summary&gt;
        public bool ShowSystemMenu
        {
            get { return (bool)GetValue(ShowSystemMenuProperty); }
            set { SetValue(ShowSystemMenuProperty, value); }
        }

        #endregion

        #region AllowMixedOrientation

        /// &lt;summary&gt;
        /// AllowMixedOrientation Dependency Property
        /// &lt;/summary&gt;
        public static readonly DependencyProperty AllowMixedOrientationProperty =
            DependencyProperty.Register(&quot;AllowMixedOrientation&quot;, typeof(bool), typeof(DockingManager),
                new FrameworkPropertyMetadata((bool)false));

        /// &lt;summary&gt;
        /// Gets or sets the AllowMixedOrientation property.  This dependency property 
        /// indicates if the manager should allow mixed orientation for document panes.
        /// &lt;/summary&gt;
        public bool AllowMixedOrientation
        {
            get { return (bool)GetValue(AllowMixedOrientationProperty); }
            set { SetValue(AllowMixedOrientationProperty, value); }
        }

        #endregion


    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[45,9,45,10,0],[46,13,46,133,0],[47,13,47,110,0],[48,4,48,115,0],[49,13,49,66,0],[50,9,50,10,0],[53,6,53,7,0],[54,7,54,41,0],[55,4,55,24,0],[56,5,56,12,0],[58,7,58,35,0],[59,6,59,7,0],[62,6,62,7,0],[63,7,63,14,0],[63,16,63,47,0],[63,48,63,50,0],[63,51,63,66,0],[64,7,64,8,0],[65,8,65,56,0],[66,7,66,8,0],[67,6,67,7,0],[70,6,70,29,0],[71,9,71,10,0],[72,13,72,126,0],[75,13,75,74,0],[76,13,76,78,0],[77,9,77,10,0],[84,9,88,66,0],[96,17,96,18,0],[96,19,96,63,0],[96,64,96,65,0],[97,17,97,18,0],[97,19,97,51,0],[97,52,97,53,0],[104,9,104,10,0],[105,13,105,101,0],[106,9,106,10,0],[112,9,112,10,0],[113,13,113,35,0],[114,13,114,14,0],[115,17,115,107,0],[116,17,116,76,0],[117,13,117,14,0],[119,13,119,20,0],[119,22,119,29,0],[119,30,119,32,0],[119,33,119,50,0],[120,13,120,14,0],[121,17,121,54,0],[122,17,122,37,0],[123,13,123,14,0],[125,13,125,29,0],[127,13,127,63,0],[128,13,128,67,0],[130,13,131,43,0],[132,17,132,42,0],[134,13,134,40,0],[135,13,135,33,0],[137,13,137,35,0],[139,13,139,33,0],[140,13,140,63,0],[141,13,141,67,0],[143,13,143,26,0],[144,13,144,14,0],[145,17,145,99,0],[146,17,146,101,0],[147,17,147,99,0],[148,17,148,103,0],[149,17,149,105,0],[151,17,151,24,0],[151,26,151,32,0],[151,33,151,35,0],[151,36,151,68,0],[152,17,152,18,0],[153,21,153,36,0],[154,24,154,96,0],[155,17,155,18,0],[157,17,157,24,0],[157,26,157,32,0],[157,33,157,35,0],[157,36,157,43,0],[158,17,158,18,0],[161,17,161,18,0],[162,13,162,14,0],[165,13,165,35,0],[166,13,166,14,0],[167,17,167,107,0],[168,17,168,76,0],[169,13,169,14,0],[171,13,171,39,0],[172,17,172,54,0],[177,13,177,57,0],[178,9,178,10,0],[180,9,180,60,0],[183,9,183,10,0],[184,13,184,47,0],[185,13,185,14,0],[186,17,186,35,0],[187,17,187,18,0],[188,21,188,107,0],[189,21,189,55,0],[190,17,190,18,0],[191,13,191,14,0],[192,18,192,56,0],[193,13,193,14,0],[194,17,194,50,0],[195,17,195,18,0],[200,21,200,57,0],[201,21,201,22,0],[202,25,203,29,0],[203,29,203,30,0],[203,30,204,33,0],[204,33,204,66,0],[204,66,205,37,0],[205,37,205,101,0],[205,101,206,33,0],[206,33,206,64,0],[206,64,207,29,0],[207,29,207,30,0],[207,30,207,64,0],[202,25,207,64,0],[208,21,208,22,0],[209,17,209,18,0],[211,17,211,54,0],[212,21,213,61,0],[214,13,214,14,0],[215,9,215,10,0],[218,9,218,10,0],[219,13,219,57,0],[220,9,220,10,0],[232,9,232,10,0],[233,13,233,31,0],[234,17,234,128,0],[236,13,236,71,0],[238,13,238,26,0],[239,9,239,10,0],[247,9,247,10,0],[248,13,248,40,0],[249,17,249,55,0],[250,9,250,10,0],[258,9,260,77,0],[270,17,270,18,0],[270,19,270,88,0],[270,89,270,90,0],[271,17,271,18,0],[271,19,271,65,0],[271,66,271,67,0],[281,9,281,10,0],[282,13,282,36,0],[284,13,284,35,0],[285,9,285,10,0],[288,9,288,10,0],[289,13,289,35,0],[291,13,291,40,0],[292,13,292,14,0],[293,17,293,99,0],[294,17,294,101,0],[295,17,295,99,0],[296,17,296,103,0],[297,17,297,105,0],[298,13,298,14,0],[301,9,301,10,0],[304,9,304,10,0],[305,13,305,61,0],[306,13,306,14,0],[308,17,308,24,0],[308,26,308,32,0],[308,33,308,35,0],[308,36,308,71,0],[308,71,308,91,0],[308,91,308,106,0],[308,106,308,107,0],[308,71,308,107,0],[308,107,308,108,0],[308,36,308,108,0],[309,21,309,93,0],[312,17,312,31,0],[313,21,313,43,0],[314,17,314,64,0],[315,13,315,14,0],[316,9,316,10,0],[319,9,319,10,0],[321,13,321,61,0],[322,13,322,14,0],[323,17,323,57,0],[325,17,325,24,0],[325,26,325,32,0],[325,33,325,35,0],[325,36,325,53,0],[326,17,326,18,0],[328,21,328,48,0],[329,21,329,57,0],[330,21,330,32,0],[331,17,331,18,0],[333,17,333,40,0],[334,17,334,67,0],[335,13,335,14,0],[336,9,336,10,0],[339,9,339,10,0],[340,13,340,38,0],[341,17,341,69,0],[342,13,342,52,0],[343,17,343,97,0],[344,13,344,50,0],[345,17,345,93,0],[347,13,347,43,0],[348,13,348,14,0],[349,17,349,96,0],[350,17,350,141,0],[351,17,351,42,0],[353,13,353,44,0],[354,13,354,14,0],[355,17,355,98,0],[356,17,356,143,0],[357,17,357,42,0],[360,13,360,45,0],[361,13,361,14,0],[362,17,362,100,0],[363,17,363,146,0],[364,17,364,42,0],[366,13,366,47,0],[367,13,367,14,0],[368,17,368,104,0],[369,17,369,150,0],[370,17,370,42,0],[373,13,373,57,0],[374,13,374,14,0],[375,17,375,64,0],[376,21,376,33,0],[377,17,377,71,0],[378,17,381,19,0],[382,17,382,53,0],[384,17,384,116,0],[385,17,385,47,0],[386,17,386,18,0],[388,21,388,66,0],[390,21,390,65,0],[391,21,391,63,0],[392,21,392,67,0],[393,21,393,69,0],[394,17,394,18,0],[396,17,396,45,0],[397,17,397,30,0],[399,17,399,81,0],[400,17,400,18,0],[401,19,401,61,0],[402,17,402,18,0],[403,17,403,30,0],[406,13,406,55,0],[407,13,407,14,0],[408,17,408,64,0],[409,21,409,33,0],[410,17,410,69,0],[411,17,414,19,0],[415,17,415,53,0],[417,17,417,62,0],[418,17,418,47,0],[419,17,419,18,0],[421,21,421,66,0],[423,21,423,65,0],[424,21,424,63,0],[425,21,425,67,0],[426,21,426,69,0],[427,17,427,18,0],[429,17,429,45,0],[430,17,430,30,0],[432,17,432,81,0],[433,17,433,18,0],[434,19,434,61,0],[435,17,435,18,0],[436,17,436,30,0],[439,13,439,41,0],[440,13,440,14,0],[441,17,441,105,0],[442,17,442,42,0],[445,13,445,25,0],[446,9,446,10,0],[455,9,458,82,0],[466,17,466,18,0],[466,19,466,82,0],[466,83,466,84,0],[467,17,467,18,0],[467,19,467,65,0],[467,66,467,67,0],[474,9,474,10,0],[475,13,475,66,0],[476,9,476,10,0],[482,9,482,10,0],[483,9,483,10,0],[492,9,495,84,0],[503,17,503,18,0],[503,19,503,84,0],[503,85,503,86,0],[504,17,504,18,0],[504,19,504,67,0],[504,68,504,69,0],[511,9,511,10,0],[512,13,512,68,0],[513,9,513,10,0],[519,9,519,10,0],[520,9,520,10,0],[529,9,531,71,0],[539,17,539,18,0],[539,19,539,80,0],[539,81,539,82,0],[540,17,540,18,0],[540,19,540,63,0],[540,64,540,65,0],[550,9,552,71,0],[560,17,560,18,0],[560,19,560,81,0],[560,82,560,83,0],[561,17,561,18,0],[561,19,561,64,0],[561,65,561,66,0],[571,9,573,71,0],[581,17,581,18,0],[581,19,581,76,0],[581,77,581,78,0],[582,17,582,18,0],[582,19,582,59,0],[582,60,582,61,0],[592,9,595,86,0],[603,17,603,18,0],[603,19,603,76,0],[603,77,603,78,0],[604,17,604,18,0],[604,19,604,69,0],[604,70,604,71,0],[611,9,611,10,0],[612,13,612,70,0],[613,9,613,10,0],[619,9,619,10,0],[620,9,620,10,0],[629,9,632,88,0],[640,17,640,18,0],[640,19,640,78,0],[640,79,640,80,0],[641,17,641,18,0],[641,19,641,71,0],[641,72,641,73,0],[648,9,648,10,0],[649,13,649,72,0],[650,9,650,10,0],[656,9,656,10,0],[657,9,657,10,0],[666,9,670,82,0],[678,17,678,18,0],[678,19,678,81,0],[678,82,678,83,0],[679,17,679,18,0],[679,19,679,67,0],[679,68,679,69,0],[686,9,686,10,0],[687,13,687,68,0],[688,9,688,10,0],[694,9,694,10,0],[695,9,695,10,0],[701,9,701,10,0],[702,13,703,76,0],[704,17,704,29,0],[705,13,705,26,0],[706,9,706,10,0],[715,9,719,90,0],[727,17,727,18,0],[727,19,727,97,0],[727,98,727,99,0],[728,17,728,18,0],[728,19,728,75,0],[728,76,728,77,0],[735,9,735,10,0],[736,13,736,76,0],[737,9,737,10,0],[743,9,743,10,0],[744,13,745,48,0],[746,17,746,47,0],[748,13,748,68,0],[749,17,749,93,0],[751,9,751,10,0],[757,9,757,10,0],[758,13,758,26,0],[759,9,759,10,0],[768,9,772,81,0],[780,17,780,18,0],[780,19,780,80,0],[780,81,780,82,0],[781,17,781,18,0],[781,19,781,66,0],[781,67,781,68,0],[788,9,788,10,0],[789,13,789,67,0],[790,9,790,10,0],[796,9,796,10,0],[797,9,797,10,0],[803,9,803,10,0],[804,13,805,75,0],[806,17,806,29,0],[808,13,808,26,0],[809,9,809,10,0],[818,9,822,89,0],[830,17,830,18,0],[830,19,830,96,0],[830,97,830,98,0],[831,17,831,18,0],[831,19,831,74,0],[831,75,831,76,0],[838,9,838,10,0],[839,13,839,75,0],[840,9,840,10,0],[846,9,846,10,0],[847,13,847,36,0],[848,17,848,46,0],[849,9,849,10,0],[855,9,855,10,0],[856,13,856,26,0],[857,9,857,10,0],[866,9,870,83,0],[878,17,878,18,0],[878,19,878,82,0],[878,83,878,84,0],[879,17,879,18,0],[879,19,879,68,0],[879,69,879,70,0],[886,9,886,10,0],[887,13,887,69,0],[888,9,888,10,0],[894,9,894,10,0],[895,9,895,10,0],[901,9,901,10,0],[902,13,903,77,0],[904,17,904,29,0],[905,13,905,26,0],[906,9,906,10,0],[915,9,918,93,0],[926,17,926,18,0],[926,19,926,98,0],[926,99,926,100,0],[927,17,927,18,0],[927,19,927,76,0],[927,77,927,78,0],[934,9,934,10,0],[935,13,935,77,0],[936,9,936,10,0],[942,9,942,10,0],[943,13,944,49,0],[945,17,945,48,0],[946,9,946,10,0],[955,9,959,84,0],[967,17,967,18,0],[967,19,967,83,0],[967,84,967,85,0],[968,17,968,18,0],[968,19,968,69,0],[968,70,968,71,0],[975,9,975,10,0],[976,13,976,70,0],[977,9,977,10,0],[983,9,983,10,0],[984,9,984,10,0],[990,9,990,10,0],[991,13,992,78,0],[993,17,993,29,0],[995,13,995,26,0],[996,9,996,10,0],[1005,9,1008,94,0],[1016,17,1016,18,0],[1016,19,1016,99,0],[1016,100,1016,101,0],[1017,17,1017,18,0],[1017,19,1017,77,0],[1017,78,1017,79,0],[1024,9,1024,10,0],[1025,13,1025,78,0],[1026,9,1026,10,0],[1032,9,1032,10,0],[1033,13,1033,36,0],[1034,17,1034,49,0],[1035,9,1035,10,0],[1040,9,1040,10,0],[1043,13,1043,40,0],[1044,9,1044,10,0],[1047,9,1047,10,0],[1050,13,1050,47,0],[1051,9,1051,10,0],[1054,9,1054,10,0],[1056,13,1056,48,0],[1057,9,1057,10,0],[1060,9,1060,10,0],[1062,13,1062,43,0],[1063,9,1063,10,0],[1066,9,1066,10,0],[1068,13,1068,33,0],[1069,9,1069,10,0],[1078,9,1081,77,0],[1089,17,1089,18,0],[1089,19,1089,80,0],[1089,81,1089,82,0],[1090,17,1090,18,0],[1090,19,1090,60,0],[1090,61,1090,62,0],[1097,9,1097,10,0],[1098,13,1098,61,0],[1099,9,1099,10,0],[1105,9,1105,10,0],[1106,13,1106,36,0],[1107,17,1107,56,0],[1108,13,1108,36,0],[1109,17,1109,53,0],[1110,9,1110,10,0],[1119,9,1122,76,0],[1130,17,1130,18,0],[1130,19,1130,84,0],[1130,85,1130,86,0],[1131,17,1131,18,0],[1131,19,1131,59,0],[1131,60,1131,61,0],[1138,9,1138,10,0],[1139,13,1139,60,0],[1140,9,1140,10,0],[1146,9,1146,10,0],[1147,13,1147,36,0],[1148,17,1148,56,0],[1149,13,1149,36,0],[1150,17,1150,53,0],[1151,9,1151,10,0],[1160,9,1163,75,0],[1171,17,1171,18,0],[1171,19,1171,83,0],[1171,84,1171,85,0],[1172,17,1172,18,0],[1172,19,1172,58,0],[1172,59,1172,60,0],[1179,9,1179,10,0],[1180,13,1180,59,0],[1181,9,1181,10,0],[1187,9,1187,10,0],[1188,13,1188,36,0],[1189,17,1189,56,0],[1190,13,1190,36,0],[1191,17,1191,53,0],[1192,9,1192,10,0],[1201,9,1204,74,0],[1212,17,1212,18,0],[1212,19,1212,82,0],[1212,83,1212,84,0],[1213,17,1213,18,0],[1213,19,1213,57,0],[1213,58,1213,59,0],[1220,9,1220,10,0],[1221,13,1221,58,0],[1222,9,1222,10,0],[1228,9,1228,10,0],[1229,13,1229,36,0],[1230,17,1230,56,0],[1231,13,1231,36,0],[1232,17,1232,53,0],[1233,9,1233,10,0],[1242,9,1245,77,0],[1253,17,1253,18,0],[1253,19,1253,85,0],[1253,86,1253,87,0],[1254,17,1254,18,0],[1254,19,1254,60,0],[1254,61,1254,62,0],[1261,9,1261,10,0],[1262,13,1262,61,0],[1263,9,1263,10,0],[1269,9,1269,10,0],[1270,13,1270,36,0],[1271,17,1271,56,0],[1272,13,1272,36,0],[1273,17,1273,53,0],[1274,9,1274,10,0],[1281,9,1281,74,0],[1286,13,1286,14,0],[1287,17,1287,54,0],[1287,54,1287,84,0],[1287,84,1287,102,0],[1287,17,1287,102,0],[1288,13,1288,14,0],[1293,9,1293,10,0],[1296,13,1296,47,0],[1296,47,1296,77,0],[1296,77,1296,97,0],[1296,13,1296,97,0],[1297,17,1297,49,0],[1299,13,1299,47,0],[1299,47,1299,77,0],[1299,77,1299,97,0],[1299,13,1299,97,0],[1300,17,1300,24,0],[1302,13,1302,62,0],[1303,13,1303,38,0],[1304,9,1304,10,0],[1307,9,1307,10,0],[1310,13,1310,68,0],[1310,68,1310,109,0],[1310,109,1310,111,0],[1310,13,1310,111,0],[1311,13,1311,36,0],[1312,17,1312,53,0],[1313,13,1313,41,0],[1314,9,1314,10,0],[1317,9,1317,10,0],[1318,13,1318,20,0],[1318,22,1318,31,0],[1318,32,1318,34,0],[1318,35,1318,65,0],[1318,65,1318,95,0],[1318,95,1318,106,0],[1318,35,1318,106,0],[1319,17,1319,43,0],[1320,13,1320,38,0],[1321,9,1321,10,0],[1327,9,1327,10,0],[1328,13,1328,63,0],[1343,9,1343,10,0],[1346,9,1346,10,0],[1347,13,1347,59,0],[1348,9,1348,10,0],[1352,9,1352,10,0],[1353,13,1353,87,0],[1355,13,1355,48,0],[1356,17,1356,57,0],[1358,17,1358,74,0],[1360,13,1360,40,0],[1361,17,1361,42,0],[1363,13,1363,66,0],[1364,9,1364,10,0],[1370,9,1370,10,0],[1371,13,1371,34,0],[1372,9,1372,10,0],[1379,9,1382,76,0],[1384,9,1385,60,0],[1393,17,1393,18,0],[1393,19,1393,88,0],[1393,89,1393,90,0],[1402,9,1402,10,0],[1403,13,1403,56,0],[1404,9,1404,10,0],[1410,9,1410,10,0],[1411,13,1411,60,0],[1412,9,1412,10,0],[1418,9,1418,10,0],[1419,13,1419,36,0],[1420,17,1420,56,0],[1421,13,1421,36,0],[1422,17,1422,53,0],[1424,9,1424,10,0],[1532,9,1532,93,0],[1535,9,1535,10,0],[1536,13,1536,40,0],[1537,17,1537,24,0],[1538,13,1538,77,0],[1539,13,1540,55,0],[1541,17,1541,59,0],[1543,13,1543,65,0],[1544,13,1544,101,0],[1545,13,1545,110,0],[1546,13,1546,102,0],[1548,13,1548,73,0],[1549,13,1549,14,0],[1550,17,1550,89,0],[1551,17,1551,87,0],[1552,13,1552,14,0],[1554,13,1554,71,0],[1556,13,1556,57,0],[1557,13,1557,59,0],[1559,13,1559,32,0],[1560,17,1560,73,0],[1561,13,1561,33,0],[1562,17,1562,75,0],[1564,13,1564,32,0],[1565,17,1565,66,0],[1566,13,1566,33,0],[1567,17,1567,68,0],[1571,13,1571,50,0],[1572,13,1572,14,0],[1573,17,1573,74,0],[1574,17,1588,19,0],[1590,17,1590,48,0],[1591,17,1599,23,0],[1600,13,1600,14,0],[1602,13,1602,14,0],[1603,17,1603,73,0],[1604,17,1607,19,0],[1609,17,1609,48,0],[1611,17,1618,19,0],[1619,13,1619,14,0],[1626,13,1626,30,0],[1628,13,1628,37,0],[1630,13,1630,28,0],[1632,13,1633,13,0],[1633,13,1633,14,0],[1633,14,1634,17,0],[1634,17,1634,31,0],[1634,31,1635,21,0],[1635,21,1635,38,0],[1635,38,1636,17,0],[1636,17,1636,28,0],[1636,28,1637,13,0],[1637,13,1637,14,0],[1637,14,1637,42,0],[1632,13,1637,42,0],[1638,9,1638,10,0],[1641,9,1641,10,0],[1642,13,1642,45,0],[1642,45,1642,56,0],[1642,56,1642,58,0],[1642,13,1642,58,0],[1643,17,1643,24,0],[1644,13,1644,85,0],[1645,13,1645,94,0],[1647,13,1647,70,0],[1648,13,1648,72,0],[1649,13,1649,68,0],[1650,13,1650,66,0],[1654,13,1654,32,0],[1655,17,1655,60,0],[1656,13,1656,33,0],[1657,17,1657,62,0],[1659,13,1669,15,0],[1671,13,1671,95,0],[1672,13,1672,78,0],[1673,13,1673,49,0],[1674,13,1674,14,0],[1675,17,1675,105,0],[1677,17,1677,43,0],[1678,17,1678,18,0],[1679,21,1679,100,0],[1680,21,1680,83,0],[1681,21,1681,88,0],[1682,17,1682,18,0],[1684,17,1684,71,0],[1685,17,1685,59,0],[1686,13,1686,14,0],[1688,13,1688,45,0],[1689,13,1689,14,0],[1690,17,1690,77,0],[1691,13,1691,14,0],[1696,13,1706,15,0],[1708,13,1708,44,0],[1710,13,1715,15,0],[1723,13,1723,30,0],[1725,13,1725,37,0],[1727,13,1727,33,0],[1729,13,1729,30,0],[1730,13,1730,24,0],[1732,9,1732,10,0],[1735,9,1735,10,0],[1736,13,1736,55,0],[1738,13,1738,38,0],[1739,17,1739,29,0],[1741,13,1741,86,0],[1743,13,1743,124,0],[1744,13,1744,49,0],[1745,13,1745,14,0],[1746,17,1746,134,0],[1746,81,1746,132,0],[1747,17,1747,69,0],[1748,21,1748,39,0],[1750,17,1750,115,0],[1751,13,1751,14,0],[1752,9,1752,10,0],[1755,9,1755,10,0],[1756,13,1756,44,0],[1757,9,1757,10,0],[1761,17,1761,18,0],[1761,19,1761,34,0],[1761,35,1761,36,0],[1768,9,1768,10,0],[1769,13,1769,137,0],[1770,13,1770,54,0],[1771,9,1771,10,0],[1775,17,1775,18,0],[1775,19,1775,31,0],[1775,32,1775,33,0],[1778,9,1778,45,0],[1780,9,1780,10,0],[1781,13,1781,40,0],[1782,13,1782,14,0],[1783,17,1783,58,0],[1784,13,1784,14,0],[1785,13,1785,134,0],[1786,13,1786,51,0],[1787,13,1787,49,0],[1788,13,1788,53,0],[1789,13,1789,55,0],[1790,9,1790,10,0],[1793,9,1793,10,0],[1794,13,1794,40,0],[1795,13,1795,14,0],[1796,17,1796,40,0],[1797,17,1797,39,0],[1798,13,1798,14,0],[1799,9,1799,10,0],[1802,9,1802,10,0],[1804,13,1804,35,0],[1805,13,1805,51,0],[1806,13,1806,48,0],[1807,13,1807,35,0],[1808,13,1808,35,0],[1809,9,1809,10,0],[1812,9,1812,10,0],[1814,13,1814,27,0],[1815,13,1815,41,0],[1816,13,1816,46,0],[1817,9,1817,10,0],[1819,9,1819,39,0],[1822,9,1822,10,0],[1823,13,1823,32,0],[1824,17,1824,31,0],[1826,13,1826,93,0],[1828,13,1828,44,0],[1830,13,1830,38,0],[1831,13,1831,14,0],[1832,17,1834,51,0],[1836,17,1836,24,0],[1836,26,1836,38,0],[1836,39,1836,41,0],[1836,42,1836,96,0],[1837,17,1837,18,0],[1838,21,1838,60,0],[1839,21,1839,22,0],[1840,25,1842,59,0],[1843,21,1843,22,0],[1844,17,1844,18,0],[1845,13,1845,14,0],[1847,13,1847,20,0],[1847,22,1847,34,0],[1847,35,1847,37,0],[1847,38,1847,90,0],[1848,13,1848,14,0],[1849,17,1851,49,0],[1852,13,1852,14,0],[1854,13,1854,20,0],[1854,22,1854,34,0],[1854,35,1854,37,0],[1854,38,1854,95,0],[1855,13,1855,14,0],[1856,17,1856,84,0],[1857,17,1857,60,0],[1857,60,1857,71,0],[1857,71,1857,86,0],[1857,17,1857,86,0],[1858,17,1858,18,0],[1859,21,1861,58,0],[1862,17,1862,18,0],[1863,13,1863,14,0],[1865,13,1865,27,0],[1866,9,1866,10,0],[1869,9,1869,10,0],[1870,13,1870,27,0],[1871,13,1871,56,0],[1872,9,1872,10,0],[1883,9,1886,80,0],[1894,17,1894,18,0],[1894,19,1894,77,0],[1894,78,1894,79,0],[1895,17,1895,18,0],[1895,19,1895,63,0],[1895,64,1895,65,0],[1902,9,1902,10,0],[1903,13,1903,64,0],[1904,9,1904,10,0],[1910,9,1910,10,0],[1911,9,1911,10,0],[1920,9,1923,88,0],[1931,17,1931,18,0],[1931,19,1931,93,0],[1931,94,1931,95,0],[1932,17,1932,18,0],[1932,19,1932,71,0],[1932,72,1932,73,0],[1939,9,1939,10,0],[1940,13,1940,72,0],[1941,9,1941,10,0],[1947,9,1947,10,0],[1948,9,1948,10,0],[1960,9,1963,77,0],[1971,17,1971,18,0],[1971,19,1971,73,0],[1971,74,1971,75,0],[1972,17,1972,18,0],[1972,19,1972,60,0],[1972,61,1972,62,0],[1979,9,1979,10,0],[1980,13,1980,61,0],[1981,9,1981,10,0],[1987,9,1987,10,0],[1988,13,1988,70,0],[1989,13,1989,70,0],[1990,9,1990,10,0],[1994,9,1994,10,0],[1995,13,1995,41,0],[1996,17,1996,24,0],[1998,13,1998,32,0],[1999,17,1999,24,0],[2003,13,2003,95,0],[2003,95,2003,104,0],[2003,104,2003,116,0],[2003,13,2003,116,0],[2004,13,2004,60,0],[2005,13,2005,88,0],[2007,13,2007,20,0],[2007,22,2007,34,0],[2007,35,2007,37,0],[2007,38,2007,71,0],[2008,13,2008,14,0],[2009,17,2009,58,0],[2010,21,2010,62,0],[2011,13,2011,14,0],[2014,13,2014,52,0],[2015,13,2015,52,0],[2016,13,2016,14,0],[2017,17,2017,88,0],[2018,13,2018,14,0],[2020,13,2020,38,0],[2021,13,2021,14,0],[2022,17,2022,99,0],[2023,13,2023,14,0],[2028,13,2028,47,0],[2029,13,2029,20,0],[2029,22,2029,49,0],[2029,50,2029,52,0],[2029,53,2029,76,0],[2030,13,2030,14,0],[2034,17,2037,19,0],[2039,17,2039,36,0],[2040,17,2040,50,0],[2041,17,2041,18,0],[2042,21,2042,111,0],[2043,17,2043,18,0],[2045,17,2045,28,0],[2046,17,2046,18,0],[2047,21,2047,46,0],[2048,25,2048,144,0],[2050,21,2050,65,0],[2051,21,2051,34,0],[2052,17,2052,18,0],[2054,17,2054,50,0],[2055,21,2055,88,0],[2058,17,2058,60,0],[2060,13,2060,14,0],[2061,13,2061,47,0],[2064,13,2064,89,0],[2065,13,2065,51,0],[2066,17,2066,136,0],[2067,9,2067,10,0],[2069,9,2069,61,0],[2072,9,2072,10,0],[2073,13,2073,32,0],[2074,17,2074,24,0],[2077,13,2077,47,0],[2078,17,2078,24,0],[2081,13,2082,98,0],[2083,13,2083,14,0],[2084,17,2084,40,0],[2085,17,2085,18,0],[2086,21,2086,102,0],[2086,102,2086,132,0],[2086,132,2086,144,0],[2086,21,2086,144,0],[2087,21,2087,28,0],[2087,30,2087,50,0],[2087,51,2087,53,0],[2087,54,2087,71,0],[2088,21,2088,22,0],[2089,25,2090,47,0],[2091,21,2091,22,0],[2092,17,2092,18,0],[2093,13,2093,14,0],[2096,13,2098,99,0],[2099,13,2099,14,0],[2100,17,2100,40,0],[2101,17,2101,18,0],[2102,21,2102,60,0],[2103,21,2103,60,0],[2104,21,2104,22,0],[2105,25,2105,96,0],[2106,21,2106,22,0],[2108,21,2108,46,0],[2109,21,2109,22,0],[2110,25,2110,107,0],[2111,21,2111,22,0],[2116,21,2116,55,0],[2118,21,2118,28,0],[2118,30,2118,57,0],[2118,58,2118,60,0],[2118,61,2118,71,0],[2119,21,2119,22,0],[2120,25,2123,27,0],[2125,25,2125,44,0],[2126,25,2126,58,0],[2127,25,2127,26,0],[2128,29,2128,119,0],[2129,25,2129,26,0],[2131,25,2131,36,0],[2132,25,2132,26,0],[2133,29,2133,54,0],[2134,33,2134,152,0],[2136,29,2136,73,0],[2137,29,2137,42,0],[2138,25,2138,26,0],[2140,25,2140,58,0],[2141,25,2141,26,0],[2142,29,2142,96,0],[2143,25,2143,26,0],[2146,25,2146,58,0],[2148,25,2148,66,0],[2149,25,2149,26,0],[2150,29,2150,72,0],[2151,25,2151,26,0],[2152,21,2152,22,0],[2153,21,2153,56,0],[2154,17,2154,18,0],[2155,13,2155,14,0],[2157,13,2157,65,0],[2158,13,2158,14,0],[2161,17,2161,97,0],[2162,17,2162,24,0],[2162,26,2162,46,0],[2162,47,2162,49,0],[2162,50,2162,67,0],[2163,17,2163,18,0],[2164,21,2165,43,0],[2166,17,2166,18,0],[2167,13,2167,14,0],[2169,13,2169,32,0],[2170,13,2170,14,0],[2171,17,2171,41,0],[2172,13,2172,14,0],[2173,9,2173,10,0],[2176,9,2176,10,0],[2177,13,2177,41,0],[2178,17,2178,24,0],[2180,13,2180,32,0],[2181,17,2181,24,0],[2183,13,2184,29,0],[2184,29,2184,64,0],[2184,64,2184,76,0],[2183,13,2184,76,0],[2186,13,2186,20,0],[2186,22,2186,42,0],[2186,43,2186,45,0],[2186,46,2186,63,0],[2187,13,2187,14,0],[2188,17,2189,39,0],[2190,13,2190,14,0],[2192,13,2192,89,0],[2193,13,2193,51,0],[2194,17,2194,136,0],[2195,9,2195,10,0],[2203,9,2203,10,0],[2204,13,2204,41,0],[2205,13,2205,14,0],[2206,17,2206,69,0],[2207,17,2207,47,0],[2208,17,2208,35,0],[2209,21,2209,28,0],[2210,13,2210,14,0],[2212,13,2212,42,0],[2213,17,2213,24,0],[2215,13,2215,30,0],[2217,13,2217,40,0],[2218,13,2218,14,0],[2219,17,2219,68,0],[2220,17,2220,46,0],[2221,13,2221,14,0],[2222,9,2222,10,0],[2240,9,2240,10,0],[2241,13,2241,20,0],[2241,22,2241,40,0],[2241,41,2241,43,0],[2241,44,2241,100,0],[2241,100,2241,200,0],[2241,200,2241,211,0],[2241,44,2241,211,0],[2242,13,2242,14,0],[2243,17,2243,46,0],[2244,21,2244,30,0],[2246,17,2246,73,0],[2247,17,2247,53,0],[2248,17,2248,18,0],[2249,21,2249,66,0],[2250,25,2250,63,0],[2251,17,2251,18,0],[2253,17,2253,18,0],[2254,21,2254,58,0],[2255,25,2255,80,0],[2256,26,2256,65,0],[2257,25,2257,82,0],[2258,17,2258,18,0],[2259,13,2259,14,0],[2260,9,2260,10,0],[2267,9,2269,67,0],[2277,17,2277,18,0],[2277,19,2277,77,0],[2277,78,2277,79,0],[2278,17,2278,18,0],[2278,19,2278,64,0],[2278,65,2278,66,0],[2288,9,2291,79,0],[2299,17,2299,18,0],[2299,19,2299,75,0],[2299,76,2299,77,0],[2300,17,2300,18,0],[2300,19,2300,62,0],[2300,63,2300,64,0],[2307,9,2307,10,0],[2308,13,2308,63,0],[2309,9,2309,10,0],[2315,9,2315,10,0],[2316,13,2316,72,0],[2317,13,2317,72,0],[2318,9,2318,10,0],[2321,9,2321,10,0],[2322,13,2322,43,0],[2323,17,2323,24,0],[2325,13,2325,32,0],[2326,17,2326,24,0],[2330,13,2330,99,0],[2330,99,2330,108,0],[2330,108,2330,120,0],[2330,13,2330,120,0],[2331,13,2331,64,0],[2332,13,2332,92,0],[2334,13,2334,20,0],[2334,22,2334,34,0],[2334,35,2334,37,0],[2334,38,2334,73,0],[2335,13,2335,14,0],[2336,17,2336,60,0],[2337,21,2337,64,0],[2338,13,2338,14,0],[2340,13,2340,56,0],[2341,13,2341,46,0],[2342,13,2342,14,0],[2344,17,2344,86,0],[2345,13,2345,14,0],[2347,13,2347,40,0],[2348,13,2348,14,0],[2350,17,2350,100,0],[2350,100,2350,168,0],[2350,168,2350,187,0],[2350,17,2350,187,0],[2351,13,2351,14,0],[2353,13,2353,40,0],[2354,13,2354,14,0],[2356,17,2356,103,0],[2357,13,2357,14,0],[2359,13,2359,47,0],[2360,13,2360,20,0],[2360,22,2360,51,0],[2360,52,2360,54,0],[2360,55,2360,80,0],[2361,13,2361,14,0],[2362,17,2365,19,0],[2367,17,2367,36,0],[2368,17,2368,50,0],[2369,17,2369,18,0],[2370,21,2370,117,0],[2371,17,2371,18,0],[2373,17,2373,28,0],[2374,17,2374,18,0],[2375,21,2375,48,0],[2376,21,2376,22,0],[2377,25,2377,106,0],[2378,25,2378,54,0],[2379,25,2379,26,0],[2380,29,2380,76,0],[2381,25,2381,26,0],[2383,25,2383,60,0],[2384,25,2384,127,0],[2385,25,2385,70,0],[2386,21,2386,22,0],[2388,21,2388,69,0],[2389,21,2389,34,0],[2390,17,2390,18,0],[2392,17,2392,50,0],[2393,21,2393,92,0],[2396,17,2396,64,0],[2398,13,2398,14,0],[2400,13,2400,48,0],[2402,13,2402,93,0],[2403,13,2403,53,0],[2404,17,2404,140,0],[2405,9,2405,10,0],[2407,9,2407,63,0],[2410,9,2410,10,0],[2411,13,2411,32,0],[2412,17,2412,24,0],[2415,13,2415,49,0],[2416,17,2416,24,0],[2419,13,2420,98,0],[2421,13,2421,14,0],[2422,17,2422,40,0],[2423,17,2423,18,0],[2424,21,2424,106,0],[2424,106,2424,136,0],[2424,136,2424,148,0],[2424,21,2424,148,0],[2425,21,2425,28,0],[2425,30,2425,52,0],[2425,53,2425,55,0],[2425,56,2425,75,0],[2426,21,2426,22,0],[2427,25,2428,49,0],[2429,21,2429,22,0],[2430,17,2430,18,0],[2431,13,2431,14,0],[2434,13,2436,99,0],[2437,13,2437,14,0],[2438,17,2438,40,0],[2439,17,2439,18,0],[2440,21,2440,64,0],[2442,21,2442,54,0],[2443,21,2443,22,0],[2445,25,2445,94,0],[2446,21,2446,22,0],[2448,21,2448,48,0],[2449,21,2449,22,0],[2451,25,2451,108,0],[2451,108,2451,176,0],[2451,176,2451,195,0],[2451,25,2451,195,0],[2452,21,2452,22,0],[2454,21,2454,48,0],[2455,21,2455,22,0],[2457,25,2457,111,0],[2458,21,2458,22,0],[2460,21,2460,55,0],[2461,21,2461,28,0],[2461,30,2461,59,0],[2461,60,2461,62,0],[2461,63,2461,73,0],[2462,21,2462,22,0],[2463,25,2466,27,0],[2468,25,2468,44,0],[2469,25,2469,58,0],[2470,25,2470,26,0],[2471,29,2471,125,0],[2472,25,2472,26,0],[2474,25,2474,36,0],[2475,25,2475,26,0],[2476,29,2476,56,0],[2477,29,2477,30,0],[2478,33,2478,114,0],[2479,33,2479,62,0],[2480,33,2480,34,0],[2481,37,2481,84,0],[2482,33,2482,34,0],[2484,33,2484,68,0],[2485,33,2485,135,0],[2486,33,2486,78,0],[2487,29,2487,30,0],[2489,29,2489,77,0],[2490,29,2490,42,0],[2491,25,2491,26,0],[2493,25,2493,58,0],[2494,25,2494,26,0],[2495,29,2495,100,0],[2496,25,2496,26,0],[2498,25,2498,60,0],[2500,25,2500,66,0],[2501,25,2501,26,0],[2502,29,2502,76,0],[2503,25,2503,26,0],[2505,21,2505,22,0],[2506,21,2506,56,0],[2507,17,2507,18,0],[2508,13,2508,14,0],[2510,13,2510,65,0],[2511,13,2511,14,0],[2514,17,2514,101,0],[2515,17,2515,24,0],[2515,26,2515,48,0],[2515,49,2515,51,0],[2515,52,2515,71,0],[2516,17,2516,18,0],[2517,21,2518,45,0],[2519,17,2519,18,0],[2520,13,2520,14,0],[2522,13,2522,32,0],[2523,17,2523,41,0],[2524,9,2524,10,0],[2527,9,2527,10,0],[2528,13,2528,43,0],[2529,17,2529,24,0],[2531,13,2531,32,0],[2532,17,2532,24,0],[2534,13,2535,29,0],[2535,29,2535,66,0],[2535,66,2535,78,0],[2534,13,2535,78,0],[2537,13,2537,20,0],[2537,22,2537,44,0],[2537,45,2537,47,0],[2537,48,2537,67,0],[2538,13,2538,14,0],[2539,17,2540,41,0],[2541,13,2541,14,0],[2543,13,2543,93,0],[2544,13,2544,53,0],[2545,17,2545,140,0],[2546,9,2546,10,0],[2551,9,2551,10,0],[2552,13,2552,56,0],[2553,13,2553,55,0],[2554,13,2554,14,0],[2555,17,2555,40,0],[2556,21,2556,44,0],[2558,17,2558,31,0],[2559,17,2559,24,0],[2561,9,2561,10,0],[2564,9,2564,10,0],[2565,13,2565,56,0],[2566,13,2566,31,0],[2567,13,2567,14,0],[2569,17,2569,30,0],[2570,13,2570,14,0],[2571,9,2571,10,0],[2574,9,2574,10,0],[2575,13,2575,42,0],[2576,9,2576,10,0],[2579,9,2579,10,0],[2580,13,2580,36,0],[2581,9,2581,10,0],[2584,9,2584,10,0],[2585,13,2585,31,0],[2586,9,2586,10,0],[2589,9,2589,10,0],[2590,13,2590,38,0],[2591,9,2591,10,0],[2598,9,2601,75,0],[2609,17,2609,18,0],[2609,19,2609,66,0],[2609,67,2609,68,0],[2610,17,2610,18,0],[2610,19,2610,58,0],[2610,59,2610,60,0],[2617,9,2617,10,0],[2618,13,2618,70,0],[2619,13,2619,59,0],[2620,9,2620,10,0],[2626,9,2626,10,0],[2627,13,2627,46,0],[2628,17,2628,61,0],[2629,9,2629,10,0],[2632,9,2632,54,0],[2634,9,2634,10,0],[2635,13,2635,99,0],[2635,99,2635,149,0],[2635,149,2635,151,0],[2635,13,2635,151,0],[2636,13,2636,52,0],[2637,13,2637,50,0],[2638,13,2638,53,0],[2639,9,2639,10,0],[2650,9,2652,67,0],[2660,17,2660,18,0],[2660,19,2660,79,0],[2660,80,2660,81,0],[2661,17,2661,18,0],[2661,19,2661,66,0],[2661,67,2661,68,0],[2671,9,2674,67,0],[2682,17,2682,18,0],[2682,19,2682,57,0],[2682,58,2682,59,0],[2683,17,2683,18,0],[2683,19,2683,50,0],[2683,51,2683,52,0],[2690,9,2690,10,0],[2691,13,2691,51,0],[2692,9,2692,10,0],[2698,9,2698,10,0],[2699,13,2699,48,0],[2700,13,2700,48,0],[2701,13,2701,44,0],[2702,13,2702,34,0],[2703,13,2703,14,0],[2704,17,2705,70,0],[2705,70,2705,107,0],[2705,107,2705,109,0],[2704,17,2705,109,0],[2706,17,2706,56,0],[2707,21,2708,53,0],[2709,13,2709,14,0],[2711,13,2711,34,0],[2712,13,2712,14,0],[2713,17,2713,115,0],[2714,13,2714,14,0],[2716,13,2716,20,0],[2716,22,2716,29,0],[2716,30,2716,32,0],[2716,33,2716,40,0],[2717,17,2717,52,0],[2719,13,2719,42,0],[2720,17,2720,57,0],[2722,13,2722,40,0],[2723,17,2723,55,0],[2724,9,2724,10,0],[2733,9,2735,61,0],[2743,17,2743,18,0],[2743,19,2743,70,0],[2743,71,2743,72,0],[2744,17,2744,18,0],[2744,19,2744,62,0],[2744,63,2744,64,0],[2754,9,2756,61,0],[2764,17,2764,18,0],[2764,19,2764,71,0],[2764,72,2764,73,0],[2765,17,2765,18,0],[2765,19,2765,63,0],[2765,64,2765,65,0],[2771,9,2771,10,0],[2772,13,2772,37,0],[2773,9,2773,10,0],[2780,9,2784,94,0],[2792,17,2792,18,0],[2792,19,2792,93,0],[2792,94,2792,95,0],[2793,17,2793,18,0],[2793,19,2793,79,0],[2793,80,2793,81,0],[2800,9,2800,10,0],[2801,13,2801,80,0],[2802,9,2802,10,0],[2808,9,2808,10,0],[2809,9,2809,10,0],[2815,9,2815,10,0],[2816,13,2817,88,0],[2818,17,2818,29,0],[2819,13,2819,31,0],[2820,17,2820,67,0],[2822,13,2822,26,0],[2823,9,2823,10,0],[2832,9,2836,102,0],[2844,17,2844,18,0],[2844,19,2844,109,0],[2844,110,2844,111,0],[2845,17,2845,18,0],[2845,19,2845,87,0],[2845,88,2845,89,0],[2852,9,2852,10,0],[2853,13,2853,88,0],[2854,9,2854,10,0],[2860,9,2860,10,0],[2861,13,2862,60,0],[2863,17,2863,59,0],[2865,9,2865,10,0],[2871,9,2871,10,0],[2872,13,2872,26,0],[2873,9,2873,10,0],[2882,9,2884,68,0],[2892,17,2892,18,0],[2892,19,2892,78,0],[2892,79,2892,80,0],[2893,17,2893,18,0],[2893,19,2893,64,0],[2893,65,2893,66,0],[2903,9,2905,76,0],[2913,17,2913,18,0],[2913,19,2913,94,0],[2913,95,2913,96,0],[2914,17,2914,18,0],[2914,19,2914,72,0],[2914,73,2914,74,0],[2921,9,2921,64,0],[2923,45,2923,46,0],[2923,47,2923,67,0],[2923,68,2923,69,0],[2925,9,2925,49,0],[2928,9,2928,10,0],[2929,13,2929,32,0],[2930,13,2930,14,0],[2931,17,2931,55,0],[2931,55,2931,65,0],[2931,65,2931,67,0],[2931,17,2931,67,0],[2932,17,2932,38,0],[2933,17,2933,102,0],[2934,17,2934,106,0],[2935,13,2935,14,0],[2936,9,2936,10,0],[2939,9,2939,10,0],[2940,13,2940,44,0],[2941,17,2941,24,0],[2943,13,2943,41,0],[2944,9,2944,10,0],[2947,9,2947,10,0],[2948,13,2948,44,0],[2949,17,2949,24,0],[2951,13,2951,20,0],[2951,22,2951,33,0],[2951,34,2951,36,0],[2951,37,2951,81,0],[2952,13,2952,14,0],[2953,17,2953,47,0],[2954,21,2954,73,0],[2956,21,2956,77,0],[2957,13,2957,14,0],[2959,13,2959,41,0],[2960,9,2960,10,0],[2963,9,2963,66,0],[2965,9,2965,10,0],[2966,13,2966,55,0],[2967,17,2967,24,0],[2968,13,2969,17,0],[2969,17,2969,18,0],[2969,18,2970,21,0],[2970,21,2970,58,0],[2970,58,2971,21,0],[2971,21,2971,28,0],[2971,28,2971,30,0],[2971,30,2971,46,0],[2971,46,2971,47,0],[2971,47,2971,49,0],[2971,49,2971,50,0],[2971,50,2971,77,0],[2971,77,2971,110,0],[2971,110,2971,121,0],[2971,50,2971,121,0],[2971,121,2972,21,0],[2972,21,2972,22,0],[2972,22,2974,25,0],[2974,25,2976,61,0],[2976,61,2977,25,0],[2977,25,2977,26,0],[2977,26,2979,25,0],[2979,25,2979,26,0],[2979,26,2981,25,0],[2981,25,2981,47,0],[2981,47,2982,25,0],[2982,25,2982,59,0],[2982,59,2984,21,0],[2984,21,2984,22,0],[2984,22,2985,17,0],[2985,17,2985,18,0],[2985,18,2985,21,0],[2968,13,2985,21,0],[2986,9,2986,10,0],[2990,9,2990,10,0],[2991,13,2991,32,0],[2992,13,2992,14,0],[2993,17,2993,24,0],[2993,26,2993,38,0],[2993,39,2993,41,0],[2993,42,2993,97,0],[2994,17,2994,18,0],[2995,21,2995,56,0],[3000,17,3000,18,0],[3001,17,3001,24,0],[3001,26,3001,40,0],[3001,41,3001,43,0],[3001,44,3001,101,0],[3002,17,3002,18,0],[3003,21,3003,60,0],[3008,17,3008,18,0],[3010,17,3010,102,0],[3011,17,3011,106,0],[3012,13,3012,14,0],[3013,9,3013,10,0],[3016,9,3016,10,0],[3017,13,3017,48,0],[3018,13,3018,50,0],[3019,17,3019,61,0],[3020,18,3020,63,0],[3021,17,3021,111,0],[3022,13,3022,46,0],[3023,9,3023,10,0],[3026,9,3026,10,0],[3027,13,3027,42,0],[3027,42,3027,79,0],[3027,79,3027,81,0],[3027,13,3027,81,0],[3028,17,3028,24,0],[3030,13,3030,57,0],[3031,13,3031,48,0],[3032,13,3032,48,0],[3033,13,3033,42,0],[3035,13,3037,54,0],[3038,13,3038,14,0],[3039,17,3039,66,0],[3040,13,3040,14,0],[3042,9,3042,10,0],[3045,9,3045,10,0],[3046,13,3046,42,0],[3046,42,3046,79,0],[3046,79,3046,81,0],[3046,13,3046,81,0],[3047,17,3047,24,0],[3049,13,3049,55,0],[3050,13,3050,48,0],[3051,13,3051,48,0],[3052,13,3052,42,0],[3054,13,3056,54,0],[3057,13,3057,14,0],[3058,17,3058,66,0],[3059,13,3059,14,0],[3061,9,3061,10,0],[3068,9,3071,86,0],[3079,17,3079,18,0],[3079,19,3079,76,0],[3079,77,3079,78,0],[3080,17,3080,18,0],[3080,19,3080,69,0],[3080,70,3080,71,0],[3087,9,3087,10,0],[3088,13,3088,70,0],[3089,9,3089,10,0],[3095,9,3095,10,0],[3096,13,3096,33,0],[3097,9,3097,10,0],[3106,9,3109,94,0],[3117,17,3117,18,0],[3117,19,3117,92,0],[3117,93,3117,94,0],[3118,17,3118,18,0],[3118,19,3118,77,0],[3118,78,3118,79,0],[3125,9,3125,10,0],[3126,13,3126,78,0],[3127,9,3127,10,0],[3133,9,3133,10,0],[3134,13,3134,33,0],[3135,9,3135,10,0],[3145,9,3145,10,0],[3146,13,3146,56,0],[3146,56,3146,85,0],[3146,85,3146,87,0],[3146,13,3146,87,0],[3147,9,3147,10,0],[3151,9,3151,49,0],[3154,9,3154,10,0],[3155,13,3155,42,0],[3156,13,3156,14,0],[3157,17,3161,19,0],[3162,13,3162,14,0],[3164,13,3164,43,0],[3165,13,3165,37,0],[3168,9,3168,10,0],[3172,17,3172,18,0],[3172,19,3172,51,0],[3172,52,3172,53,0],[3177,9,3177,10,0],[3179,13,3179,87,0],[3180,13,3180,14,0],[3181,17,3181,50,0],[3182,17,3182,18,0],[3183,21,3183,50,0],[3184,21,3184,22,0],[3185,25,3185,47,0],[3186,25,3186,42,0],[3187,21,3187,22,0],[3188,17,3188,18,0],[3189,13,3189,14,0],[3191,13,3191,38,0],[3192,9,3192,10,0],[3201,9,3203,60,0],[3211,17,3211,18,0],[3211,19,3211,65,0],[3211,66,3211,67,0],[3212,17,3212,18,0],[3212,19,3212,59,0],[3212,60,3212,61,0],[3222,9,3224,61,0],[3232,17,3232,18,0],[3232,19,3232,72,0],[3232,73,3232,74,0],[3233,17,3233,18,0],[3233,19,3233,66,0],[3233,67,3233,68,0]]);
    </script>
  </body>
</html>